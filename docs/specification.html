<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mrgsolve user guide - 2&nbsp; Model specification</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./datasets.html" rel="next">
<link href="./components.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./specification.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Model specification</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">mrgsolve user guide</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./components.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Model components</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./specification.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Model specification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Input data sets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Event objects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Model Matrices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Simulated output</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sequence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Simulation sequence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./steady-state.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Steady state</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plugins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plugins</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mtime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Modeled events</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./q-and-a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Questions and Answers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Installation</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#how-where-to-write-a-model" id="toc-how-where-to-write-a-model" class="nav-link active" data-scroll-target="#how-where-to-write-a-model"><span class="header-section-number">2.1</span> How / where to write a model</a>
  <ul class="collapse">
  <li><a href="#sec-spec-separate-file" id="toc-sec-spec-separate-file" class="nav-link" data-scroll-target="#sec-spec-separate-file"><span class="header-section-number">2.1.1</span> Separate file</a></li>
  <li><a href="#sec-spec-inline" id="toc-sec-spec-inline" class="nav-link" data-scroll-target="#sec-spec-inline"><span class="header-section-number">2.1.2</span> Inline / <code>code</code> &nbsp;</a></li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments"><span class="header-section-number">2.1.3</span> Comments</a></li>
  </ul></li>
  <li><a href="#sec-code-blocks" id="toc-sec-code-blocks" class="nav-link" data-scroll-target="#sec-code-blocks"><span class="header-section-number">2.2</span> Code blocks</a>
  <ul class="collapse">
  <li><a href="#about-code-blocks" id="toc-about-code-blocks" class="nav-link" data-scroll-target="#about-code-blocks"><span class="header-section-number">2.2.1</span> About code blocks</a></li>
  <li><a href="#programmatic-or-bulk-initialization" id="toc-programmatic-or-bulk-initialization" class="nav-link" data-scroll-target="#programmatic-or-bulk-initialization"><span class="header-section-number">2.2.2</span> Programmatic or bulk initialization</a></li>
  <li><a href="#sec-block-prob" id="toc-sec-block-prob" class="nav-link" data-scroll-target="#sec-block-prob"><span class="header-section-number">2.2.3</span> <code>$PROB</code> &nbsp;</a></li>
  <li><a href="#sec-block-param" id="toc-sec-block-param" class="nav-link" data-scroll-target="#sec-block-param"><span class="header-section-number">2.2.4</span> <code>$PARAM</code> &nbsp;</a></li>
  <li><a href="#sec-block-input" id="toc-sec-block-input" class="nav-link" data-scroll-target="#sec-block-input"><span class="header-section-number">2.2.5</span> <code>$INPUT</code> &nbsp;</a></li>
  <li><a href="#sec-block-fixed" id="toc-sec-block-fixed" class="nav-link" data-scroll-target="#sec-block-fixed"><span class="header-section-number">2.2.6</span> <code>$FIXED</code> &nbsp;</a></li>
  <li><a href="#cmt-and-init" id="toc-cmt-and-init" class="nav-link" data-scroll-target="#cmt-and-init"><span class="header-section-number">2.2.7</span> <code>$CMT</code> and <code>$INIT</code></a></li>
  <li><a href="#sec-block-main" id="toc-sec-block-main" class="nav-link" data-scroll-target="#sec-block-main"><span class="header-section-number">2.2.8</span> <code>$MAIN</code> &nbsp;</a></li>
  <li><a href="#sec-block-pk" id="toc-sec-block-pk" class="nav-link" data-scroll-target="#sec-block-pk"><span class="header-section-number">2.2.9</span> <code>$PK</code> &nbsp;</a></li>
  <li><a href="#sec-block-ode" id="toc-sec-block-ode" class="nav-link" data-scroll-target="#sec-block-ode"><span class="header-section-number">2.2.10</span> <code>$ODE</code> &nbsp;</a></li>
  <li><a href="#sec-block-des" id="toc-sec-block-des" class="nav-link" data-scroll-target="#sec-block-des"><span class="header-section-number">2.2.11</span> <code>$DES</code> &nbsp;</a></li>
  <li><a href="#sec-block-table" id="toc-sec-block-table" class="nav-link" data-scroll-target="#sec-block-table"><span class="header-section-number">2.2.12</span> <code>$TABLE</code> &nbsp;</a></li>
  <li><a href="#sec-block-error" id="toc-sec-block-error" class="nav-link" data-scroll-target="#sec-block-error"><span class="header-section-number">2.2.13</span> <code>$ERROR</code> &nbsp;</a></li>
  <li><a href="#sec-block-preamble" id="toc-sec-block-preamble" class="nav-link" data-scroll-target="#sec-block-preamble"><span class="header-section-number">2.2.14</span> <code>$PREAMBLE</code> &nbsp;</a></li>
  <li><a href="#sec-block-pred" id="toc-sec-block-pred" class="nav-link" data-scroll-target="#sec-block-pred"><span class="header-section-number">2.2.15</span> <code>$PRED</code> &nbsp;</a></li>
  <li><a href="#sec-block-capture" id="toc-sec-block-capture" class="nav-link" data-scroll-target="#sec-block-capture"><span class="header-section-number">2.2.16</span> <code>$CAPTURE</code> &nbsp;</a></li>
  <li><a href="#sec-block-omega" id="toc-sec-block-omega" class="nav-link" data-scroll-target="#sec-block-omega"><span class="header-section-number">2.2.17</span> <code>$OMEGA</code> &nbsp;</a></li>
  <li><a href="#sec-block-sigma" id="toc-sec-block-sigma" class="nav-link" data-scroll-target="#sec-block-sigma"><span class="header-section-number">2.2.18</span> <code>$SIGMA</code> &nbsp;</a></li>
  <li><a href="#sec-block-set" id="toc-sec-block-set" class="nav-link" data-scroll-target="#sec-block-set"><span class="header-section-number">2.2.19</span> <code>$SET</code></a></li>
  <li><a href="#global" id="toc-global" class="nav-link" data-scroll-target="#global"><span class="header-section-number">2.2.20</span> <code>$GLOBAL</code></a></li>
  <li><a href="#pkmodel" id="toc-pkmodel" class="nav-link" data-scroll-target="#pkmodel"><span class="header-section-number">2.2.21</span> <code>$PKMODEL</code></a></li>
  <li><a href="#sec-block-plugin" id="toc-sec-block-plugin" class="nav-link" data-scroll-target="#sec-block-plugin"><span class="header-section-number">2.2.22</span> <code>$PLUGIN</code> &nbsp;</a></li>
  <li><a href="#sec-block-theta" id="toc-sec-block-theta" class="nav-link" data-scroll-target="#sec-block-theta"><span class="header-section-number">2.2.23</span> <code>$THETA</code> &nbsp;</a></li>
  <li><a href="#sec-block-nmxml" id="toc-sec-block-nmxml" class="nav-link" data-scroll-target="#sec-block-nmxml"><span class="header-section-number">2.2.24</span> <code>$NMXML</code> &nbsp;</a></li>
  <li><a href="#sec-block-nmext" id="toc-sec-block-nmext" class="nav-link" data-scroll-target="#sec-block-nmext"><span class="header-section-number">2.2.25</span> <code>$NMEXT</code> &nbsp;</a></li>
  <li><a href="#details-1" id="toc-details-1" class="nav-link" data-scroll-target="#details-1">Details</a></li>
  <li><a href="#sec-block-include" id="toc-sec-block-include" class="nav-link" data-scroll-target="#sec-block-include"><span class="header-section-number">2.2.26</span> <code>$INCLUDE</code> &nbsp;</a></li>
  <li><a href="#sec-block-env" id="toc-sec-block-env" class="nav-link" data-scroll-target="#sec-block-env"><span class="header-section-number">2.2.27</span> <code>$ENV</code> &nbsp;</a></li>
  </ul></li>
  <li><a href="#sec-variables-macros" id="toc-sec-variables-macros" class="nav-link" data-scroll-target="#sec-variables-macros"><span class="header-section-number">2.3</span> Variables and Macros</a>
  <ul class="collapse">
  <li><a href="#id" id="toc-id" class="nav-link" data-scroll-target="#id"><span class="header-section-number">2.3.1</span> <code>ID</code></a></li>
  <li><a href="#time" id="toc-time" class="nav-link" data-scroll-target="#time"><span class="header-section-number">2.3.2</span> <code>TIME</code></a></li>
  <li><a href="#solvertime" id="toc-solvertime" class="nav-link" data-scroll-target="#solvertime"><span class="header-section-number">2.3.3</span> <code>SOLVERTIME</code></a></li>
  <li><a href="#t" id="toc-t" class="nav-link" data-scroll-target="#t"><span class="header-section-number">2.3.4</span> <code>T</code></a></li>
  <li><a href="#evid" id="toc-evid" class="nav-link" data-scroll-target="#evid"><span class="header-section-number">2.3.5</span> <code>EVID</code></a></li>
  <li><a href="#cmt" id="toc-cmt" class="nav-link" data-scroll-target="#cmt"><span class="header-section-number">2.3.6</span> <code>CMT</code></a></li>
  <li><a href="#amt" id="toc-amt" class="nav-link" data-scroll-target="#amt"><span class="header-section-number">2.3.7</span> <code>AMT</code></a></li>
  <li><a href="#newind" id="toc-newind" class="nav-link" data-scroll-target="#newind"><span class="header-section-number">2.3.8</span> <code>NEWIND</code></a></li>
  <li><a href="#ss_advance" id="toc-ss_advance" class="nav-link" data-scroll-target="#ss_advance"><span class="header-section-number">2.3.9</span> <code>SS_ADVANCE</code></a></li>
  <li><a href="#simeta" id="toc-simeta" class="nav-link" data-scroll-target="#simeta"><span class="header-section-number">2.3.10</span> <code>simeta()</code></a></li>
  <li><a href="#simeps" id="toc-simeps" class="nav-link" data-scroll-target="#simeps"><span class="header-section-number">2.3.11</span> <code>simeps()</code></a></li>
  <li><a href="#sec-self-object" id="toc-sec-self-object" class="nav-link" data-scroll-target="#sec-self-object"><span class="header-section-number">2.3.12</span> <code>self</code> &nbsp;</a></li>
  <li><a href="#sec-self.time" id="toc-sec-self.time" class="nav-link" data-scroll-target="#sec-self.time"><span class="header-section-number">2.3.13</span> <code>self.time</code></a></li>
  <li><a href="#self.cmt" id="toc-self.cmt" class="nav-link" data-scroll-target="#self.cmt"><span class="header-section-number">2.3.14</span> <code>self.cmt</code></a></li>
  <li><a href="#self.amt" id="toc-self.amt" class="nav-link" data-scroll-target="#self.amt"><span class="header-section-number">2.3.15</span> <code>self.amt</code></a></li>
  <li><a href="#self.nid" id="toc-self.nid" class="nav-link" data-scroll-target="#self.nid"><span class="header-section-number">2.3.16</span> <code>self.nid</code></a></li>
  <li><a href="#self.idn" id="toc-self.idn" class="nav-link" data-scroll-target="#self.idn"><span class="header-section-number">2.3.17</span> <code>self.idn</code></a></li>
  <li><a href="#self.nrow" id="toc-self.nrow" class="nav-link" data-scroll-target="#self.nrow"><span class="header-section-number">2.3.18</span> <code>self.nrow</code></a></li>
  <li><a href="#self.rown" id="toc-self.rown" class="nav-link" data-scroll-target="#self.rown"><span class="header-section-number">2.3.19</span> <code>self.rown</code></a></li>
  <li><a href="#self.envir" id="toc-self.envir" class="nav-link" data-scroll-target="#self.envir"><span class="header-section-number">2.3.20</span> <code>self.envir</code></a></li>
  <li><a href="#sec-self.tad" id="toc-sec-self.tad" class="nav-link" data-scroll-target="#sec-self.tad"><span class="header-section-number">2.3.21</span> <code>self.tad()</code> &nbsp;</a></li>
  <li><a href="#sec-self.mtime" id="toc-sec-self.mtime" class="nav-link" data-scroll-target="#sec-self.mtime"><span class="header-section-number">2.3.22</span> <code>self.mtime(&lt;time&gt;)</code> &nbsp;</a></li>
  <li><a href="#self.meventtime-evid" id="toc-self.meventtime-evid" class="nav-link" data-scroll-target="#self.meventtime-evid"><span class="header-section-number">2.3.23</span> <code>self.mevent(&lt;time&gt;, &lt;evid&gt;)</code></a></li>
  <li><a href="#self.stop" id="toc-self.stop" class="nav-link" data-scroll-target="#self.stop"><span class="header-section-number">2.3.24</span> <code>self.stop()</code></a></li>
  <li><a href="#self.stop_id" id="toc-self.stop_id" class="nav-link" data-scroll-target="#self.stop_id"><span class="header-section-number">2.3.25</span> <code>self.stop_id()</code></a></li>
  <li><a href="#self.stop_id_cf" id="toc-self.stop_id_cf" class="nav-link" data-scroll-target="#self.stop_id_cf"><span class="header-section-number">2.3.26</span> <code>self.stop_id_cf()</code></a></li>
  <li><a href="#thetan" id="toc-thetan" class="nav-link" data-scroll-target="#thetan"><span class="header-section-number">2.3.27</span> <code>THETA(n)</code></a></li>
  <li><a href="#etan" id="toc-etan" class="nav-link" data-scroll-target="#etan"><span class="header-section-number">2.3.28</span> <code>ETA(n)</code></a></li>
  <li><a href="#epsn" id="toc-epsn" class="nav-link" data-scroll-target="#epsn"><span class="header-section-number">2.3.29</span> <code>EPS(n)</code></a></li>
  <li><a href="#sigman" id="toc-sigman" class="nav-link" data-scroll-target="#sigman"><span class="header-section-number">2.3.30</span> <code>SIGMA(n)</code></a></li>
  <li><a href="#tablename" id="toc-tablename" class="nav-link" data-scroll-target="#tablename"><span class="header-section-number">2.3.31</span> <code>table(&lt;name&gt;)</code></a></li>
  <li><a href="#sec-spec-f" id="toc-sec-spec-f" class="nav-link" data-scroll-target="#sec-spec-f"><span class="header-section-number">2.3.32</span> <code>F_CMT</code> &nbsp;</a></li>
  <li><a href="#sec-spec-alag" id="toc-sec-spec-alag" class="nav-link" data-scroll-target="#sec-spec-alag"><span class="header-section-number">2.3.33</span> <code>ALAG_CMT</code> &nbsp;</a></li>
  <li><a href="#sec-spec-r" id="toc-sec-spec-r" class="nav-link" data-scroll-target="#sec-spec-r"><span class="header-section-number">2.3.34</span> <code>R_CMT</code> &nbsp;</a></li>
  <li><a href="#rn" id="toc-rn" class="nav-link" data-scroll-target="#rn"><span class="header-section-number">2.3.35</span> <code>Rn</code></a></li>
  <li><a href="#sec-spec-d" id="toc-sec-spec-d" class="nav-link" data-scroll-target="#sec-spec-d"><span class="header-section-number">2.3.36</span> <code>D_CMT</code> &nbsp;</a></li>
  <li><a href="#nonmem-like-syntax" id="toc-nonmem-like-syntax" class="nav-link" data-scroll-target="#nonmem-like-syntax"><span class="header-section-number">2.3.37</span> NONMEM-like syntax</a></li>
  </ul></li>
  <li><a href="#reserved-words" id="toc-reserved-words" class="nav-link" data-scroll-target="#reserved-words"><span class="header-section-number">2.4</span> Reserved words</a></li>
  <li><a href="#sec-new-variables" id="toc-sec-new-variables" class="nav-link" data-scroll-target="#sec-new-variables"><span class="header-section-number">2.5</span> Derive new variables</a>
  <ul class="collapse">
  <li><a href="#special-handling-for-double-int-bool" id="toc-special-handling-for-double-int-bool" class="nav-link" data-scroll-target="#special-handling-for-double-int-bool"><span class="header-section-number">2.5.1</span> Special handling for <code>double</code>, <code>int</code>, <code>bool</code></a></li>
  <li><a href="#initializing-and-resetting" id="toc-initializing-and-resetting" class="nav-link" data-scroll-target="#initializing-and-resetting"><span class="header-section-number">2.5.2</span> Initializing and resetting</a></li>
  <li><a href="#using-other-types-globally" id="toc-using-other-types-globally" class="nav-link" data-scroll-target="#using-other-types-globally"><span class="header-section-number">2.5.3</span> Using other types globally</a></li>
  </ul></li>
  <li><a href="#random-number-generation" id="toc-random-number-generation" class="nav-link" data-scroll-target="#random-number-generation"><span class="header-section-number">2.6</span> Random number generation</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">2.7</span> Examples</a>
  <ul class="collapse">
  <li><a href="#simple-pk-model" id="toc-simple-pk-model" class="nav-link" data-scroll-target="#simple-pk-model"><span class="header-section-number">2.7.1</span> Simple PK model</a></li>
  <li><a href="#pkpd-model" id="toc-pkpd-model" class="nav-link" data-scroll-target="#pkpd-model"><span class="header-section-number">2.7.2</span> PK/PD model</a></li>
  <li><a href="#population-pk-model-with-covariates-and-iov" id="toc-population-pk-model-with-covariates-and-iov" class="nav-link" data-scroll-target="#population-pk-model-with-covariates-and-iov"><span class="header-section-number">2.7.3</span> Population PK model with covariates and IOV</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-model-specification" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Model specification</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This chapter details the mrgsolve model specification format.</p>
<section id="how-where-to-write-a-model" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="how-where-to-write-a-model"><span class="header-section-number">2.1</span> How / where to write a model</h2>
<p>There are two ways to write your model:</p>
<ol type="1">
<li>Code in a <strong>separate file</strong> and source into your R script</li>
<li>Code <strong>inline</strong> as a character string already in your R script</li>
</ol>
<p>We recommend method <code>1</code> (separate file) for any non-trivial modeling work. Method <code>2</code> is handy for quickly coding a model and you’ll also see us using that approach frequently when demonstrating how to use mrgsolve.</p>
<section id="sec-spec-separate-file" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="sec-spec-separate-file"><span class="header-section-number">2.1.1</span> Separate file</h3>
<p>For most applications, you will want to put your model code in a standalone file. This file can have any extension, but there is some special behavior when you use the <code>.cpp</code> extension. We’ll show you both here.</p>
<section id="using-.cpp-file-extension" class="level4" data-number="2.1.1.1">
<h4 data-number="2.1.1.1" class="anchored" data-anchor-id="using-.cpp-file-extension"><span class="header-section-number">2.1.1.1</span> Using <code>.cpp</code> file extension</h4>
<p>Open a text editor and type the model code into a file with name that has the format <code>&lt;model-name&gt;.cpp</code>. This filename format identifies a “name” for your model (<code>&lt;model-name&gt;</code>, the “stem” of the file name). Note: this whole file will be read and parsed, so everything in it must be valid mrgsolve model specification elements.</p>
<p>Use the <code>mread()</code> function to read and parse this file. For the model called <code>mymodel</code> saved in <code>mymodel.cpp</code> (in the current working directory), issue the command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mread</span>(<span class="st">"mymodel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>mread()</code> returns a model object from which you can simulate.</p>
</section>
<section id="using-any-file-extension" class="level4" data-number="2.1.1.2">
<h4 data-number="2.1.1.2" class="anchored" data-anchor-id="using-any-file-extension"><span class="header-section-number">2.1.1.2</span> Using any file extension</h4>
<p>You can use any file extension to save your mrgsolve model. Rather than using <code>.cpp</code>, you might use <code>.mod</code>. When you are using an extension other than <code>.cpp</code>, pass in the entire file name, both stem and extension. If you have the model code saved in <code>mymodel.mod</code> then you’d call</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mread</span>(<span class="st">"mymodel.mod"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>to load that model.</p>
</section>
<section id="the-model-project-directory" class="level4" data-number="2.1.1.3">
<h4 data-number="2.1.1.3" class="anchored" data-anchor-id="the-model-project-directory"><span class="header-section-number">2.1.1.3</span> The model project directory</h4>
<p>The second argument to <code>mread()</code> is <code>project</code>. This is the directory where mrgsolve will look for your model file (passed as the first argument to <code>mread()</code>).</p>
<p>If your <code>myproject.mod</code> file is located in the <code>models</code> directory, then you could load that file with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mread</span>(<span class="st">"mymodel.mod"</span>, <span class="at">project =</span> <span class="st">"models"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, you can just past the entire path to the model file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mread</span>(<span class="st">"models/mymodel.mod"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sec-spec-inline" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="sec-spec-inline"><span class="header-section-number">2.1.2</span> Inline / <code>code</code> &nbsp;</h3>
<p>Often it is more convenient to write a model right in your <code>R</code> script. The model might look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>code <span class="ot">&lt;-</span> <span class="st">'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">$PARAM CL = 1, VC = 20</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">$PKMODEL ncmt=1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we created a character vector of length 1 and saved it to the <code>R</code> object called <code>code</code>. The name of this object is irrelevant. But <code>code</code> will be passed into mrgsolve as the model definition. When mrgsolve gets a model like this along with a “name” for the model, mrgsolve will write the code to a file called <code>&lt;model-name&gt;.cpp</code> and read it right back in as if you had typed the code into this file (<a href="#sec-spec-separate-file" class="quarto-xref"><span>Section 2.1.1</span></a>).</p>
<p>To parse and load this model, use the <code>mcode()</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mcode</span>(<span class="st">"mymodel"</span>, code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>mcode()</code> is a convenience wrapper for <code>mread()</code>. <code>mcode</code> writes the code to <code>mymodel.cpp</code> in <code>tempdir()</code>, reads it back in, compiles and loads.</p>
<p>The <code>mcode</code> call is equivalent to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mread</span>(<span class="st">"mymodel"</span>, <span class="fu">tempdir</span>(), code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For help, see <code>?mread</code> , <code>?mcode</code> in the <code>R</code> help system after loading mrgsolve.</p>
</section>
<section id="comments" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="comments"><span class="header-section-number">2.1.3</span> Comments</h3>
<p>You can comment out code in the model specification file with two front slashes <code>//</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> a <span class="op">=</span> <span class="fl">1.234</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">// double b = 5.678; </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This comment sequence is what is used in <code>C++</code> code, but you can use it <em>anywhere</em> in the mrgsolve model specification file.</p>
</section>
</section>
<section id="sec-code-blocks" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sec-code-blocks"><span class="header-section-number">2.2</span> Code blocks</h2>
<section id="about-code-blocks" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="about-code-blocks"><span class="header-section-number">2.2.1</span> About code blocks</h3>
<p><strong>Block identifier</strong></p>
<p>Different types of code are organized in the model specification file and separated by block identifiers. There are two ways to formulate block identifiers that can be used in mrgsolve. In the first type, a dollar-sign is placed at the start of the block name</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>$BLOCKNAME</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>block<span class="op">-</span>code<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, a block of parameters would be</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>$PARAM</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>CL <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The second way to write this is with brackets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> BLOCKNAME <span class="op">]</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>block<span class="op">-</span>code<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is no functional difference between the dollar-sign notation and the brackets. When model specification code is saved into a file with a <code>.cpp</code> extension, the code editor may make certain assumptions about formatting or styling the code. Using brackets will most-likely work better with the editor in that case.</p>
<p>Block identifiers are case-insensitive so all of these also work</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>$param </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>CL <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> param <span class="op">]</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>CL <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Users are free to include block code on the same line as the block identifier, but must include a space after the identifier. For example, the parser will recognize <code>$PARAM CL = 1</code> but not <code>$PARAMCL=1</code> as parameters.</p>
<p><strong>Block syntax</strong> Different blocks may require different syntax. For example, code written in <code>$PARAM</code> will be parsed by the <code>R</code> parser and will generally need to adhere to <code>R</code> syntax requirements. On the other hand, code in <code>$MAIN</code>, <code>$ODE</code>, and <code>$TABLE</code> will be used to make functions in <code>C++</code> and therefore will need to be valid <code>C++</code> code, including terminal <code>;</code> on each line.</p>
<p><strong>Block options</strong> Options may be specified on some code blocks that signal how the code is to be parsed or used in the simulation.</p>
<p>Block options can be boolean in which case you indicate the option name with nothing following. For example, to indicate <code>block = TRUE</code> for an OMEGA matrix, write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @block </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here <code>@block</code> indicates <code>block = TRUE</code>. Starting with mrgsolve 1.0.0, block options can be negated by writing <code>!</code> between <code>@</code> and the option name. To request a non-block (diagonal) OMEGA matrix</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @<span class="op">!</span>block </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But note well that diagonal is the default configuration for OMEGA, so it is never necessary to write this.</p>
<p>Other non-boolean block options state the name and then a value to be assigned to that name. For example, if we wanted to assign labels to the ETAs from an OMEGA block, we’d write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @labels ECL EVC</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This essentially sets labels equal to the vector <code>c("ECL", "EVC")</code>.</p>
<p>We note two specific boolean options (<code>@object</code> and <code>@as_object</code>) that have similar function across multiple blocks.</p>
</section>
<section id="programmatic-or-bulk-initialization" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="programmatic-or-bulk-initialization"><span class="header-section-number">2.2.2</span> Programmatic or bulk initialization</h3>
<p>The following describes syntax for initializing blocks as R objects using R code. This can be helpful, say, when you need to initialize a 50x50 OMEGA matrix or a series of systematically named parameters. We will describe the <code>@object</code> and <code>@as_object</code> options that are available on select blocks.</p>
<p>The <code>@object</code> option lets you name an object defined in <code>$ENV</code> to use to instantiate the block data. For example, to specify a series of parameters using the <code>@object</code> option, you’d write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>$ENV</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>params <span class="op">&lt;-</span> list<span class="op">(</span>CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> V <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> KA <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>$PARAM @object params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This tells mrgsolve that there is an object called <code>params</code> that it is in the <code>$ENV</code> environment and mrgsolve will use that to define the names and values. This is a trivial example to show how a simple series of parameters could be defined. However, the intended use for this functionality is to allow efficient creation of a large, systematically-named series of parameters in a large model.</p>
<p>The <code>@as_object</code> option is a boolean option that tells mrgsolve that the block code will actually return the object (rather than asking mrgsolve to look in <code>$ENV</code> for the object). The equivalent specification for the block above would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>$PARAM @as_object</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>list<span class="op">(</span>CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> V <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> KA <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following blocks contain both the <code>@object</code> and <code>@as_object</code> options:</p>
<ul>
<li><code>$PARAM</code></li>
<li><code>$INPUT</code></li>
<li><code>$THETA</code></li>
<li><code>$CMT</code></li>
<li><code>$INT</code></li>
<li><code>$OMEGA</code></li>
<li><code>$SIGMA</code></li>
</ul>
<p>Please see the specific block documentation for more details on the specific type of object that should be returned when this syntax is invoked.</p>
</section>
<section id="sec-block-prob" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="sec-block-prob"><span class="header-section-number">2.2.3</span> <code>$PROB</code> &nbsp;</h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@covariates</code></p>
<p>Use this block to make notes about the model. There are no restrictions on the text that gets entered here. mrgsolve does not routinely process the text in any way, except when rendering the model as a document. Frequently, we write the text here in markdown format so that it will render nicely in the model document. But this is completely optional.</p>
<p>See the annotated model in <a href="topics.html#sec-topic-annotated" class="quarto-xref"><span>Section 11.1</span></a> for an example.</p>
</section>
<section id="sec-block-param" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="sec-block-param"><span class="header-section-number">2.2.4</span> <code>$PARAM</code> &nbsp;</h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@covariates</code>, <code>@tag</code>, <code>@input</code>, <code>@object</code>, <code>@as_object</code></p>
<p>Define the parameter list in the current model. Parameters are names associated with values that can be used throughout the model. A value must be given for every parameter name. Names (and numbers) of parameters must be set at the time the model is compiled, but parameter values may be updated without re-compiling the model.</p>
<p>The <code>@covariates</code> option allows you to tag a collection of parameters as “covariates”. It does not change the functionality of the model or simulation workflow in any way, but allows you to get that list of covariate names out of the model object.</p>
<p>The <code>@input</code> option adds a tag to the parameters in the block so that input data sets will be checked for these parameters when <code>check_data_names()</code> is called. Use the <code>@tag</code> option and supply a user-defined tag that can also be used for checking data sets and parameters.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> VC <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> KA <span class="op">=</span> <span class="fl">1.2</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>KM <span class="op">=</span> <span class="dv">25</span><span class="op">,</span> VMAX <span class="op">=</span> <span class="dv">400</span><span class="op">,</span> FLAG <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> WT <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>SEX <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> N <span class="op">=</span> sqrt<span class="op">(</span><span class="dv">25</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the “values” in the parameter list will get evaluated by the R interpreter and the evaluation will happen inside the environment which is defined by the <code>$ENV</code> block. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>$ENV MWT <span class="op">=</span> <span class="fl">1.2</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>$PARAM </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>WT <span class="op">=</span> <span class="dv">80</span> <span class="op">*</span> <span class="fl">2.2</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>MASS <span class="op">=</span> <span class="dv">600</span> <span class="op">*</span> MWT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Annotated example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> @annotated</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>CL <span class="op">:</span>   <span class="dv">1</span> <span class="op">:</span> Clearance <span class="op">(</span>L<span class="op">/</span>hr<span class="op">)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>VC <span class="op">:</span>  <span class="dv">20</span> <span class="op">:</span> Volume of distribution <span class="op">(</span>L<span class="op">)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>KA<span class="op">:</span>  <span class="fl">1.2</span> <span class="op">:</span> Absorption rate constant <span class="op">(</span><span class="dv">1</span><span class="op">/</span>hr<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See the <code>popex</code> model for an example of using <code>@covariates</code></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>. 
. Model file: popex.cpp 
. 
. $PARAM
. TVKA = 0.5, TVCL = 1, TVV = 24
. 
. $PARAM
. @covariates
. WT = 70</code></pre>
</div>
</div>
<p>then</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">modlib</span>(<span class="st">"popex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(mod)<span class="sc">$</span>covariates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>. [1] "WT"</code></pre>
</div>
</div>
<p>Notes:</p>
<ul>
<li>Multiple blocks are allowed</li>
<li>Values are evaluated by the <code>R</code> interpreter</li>
</ul>
<p>The <code>@object</code> and <code>@as_object</code> options should name or return a named list of parameters.</p>
<p>See also: <a href="#sec-block-input" class="quarto-xref"><span>Section 2.2.5</span></a>, <a href="#sec-block-theta" class="quarto-xref"><span>Section 2.2.23</span></a> and <a href="#sec-block-fixed" class="quarto-xref"><span>Section 2.2.6</span></a>.</p>
<p>See <code>?param</code> in the <code>R</code> help system after loading mrgsolve.</p>
</section>
<section id="sec-block-input" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="sec-block-input"><span class="header-section-number">2.2.5</span> <code>$INPUT</code> &nbsp;</h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@covariates</code>, <code>@tag</code>, <code>@object</code>, <code>@as_object</code></p>
<p>This block operates just like $PARAM (<a href="#sec-block-param" class="quarto-xref"><span>Section 2.2.4</span></a>), in that it is a way to introduce parameters in to the model. Additionally, the <code>@input</code> tag is added to the model parameters and input data sets will be checked for these parameters when <code>check_data_names()</code> is called.</p>
<p>See also: <a href="#sec-block-param" class="quarto-xref"><span>Section 2.2.4</span></a>, <a href="#sec-block-theta" class="quarto-xref"><span>Section 2.2.23</span></a>, <a href="#sec-block-fixed" class="quarto-xref"><span>Section 2.2.6</span></a>.</p>
</section>
<section id="sec-block-fixed" class="level3" data-number="2.2.6">
<h3 data-number="2.2.6" class="anchored" data-anchor-id="sec-block-fixed"><span class="header-section-number">2.2.6</span> <code>$FIXED</code> &nbsp;</h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@object</code>, <code>@as_object</code></p>
<p>Like <code>$PARAM</code>, <code>$FIXED</code> is used to specify <code>name=value</code> pairs. Unlike <code>$PARAM</code>, however, the values associated with names in <code>$FIXED</code> are not able to be updated.</p>
<p>By default, names in <code>$FIXED</code> are associated with their value through a <code>C++</code> preprocessor <code>#define</code> statement.</p>
<p>Usually, <code>$FIXED</code> is only used when there are a very large number of parameters (<span class="math inline">\(&gt;\)</span> 100 or 200). When some of these parameters never need to be updated, you can move them to a <code>$FIXED</code> block to get a modest gain in efficiency of the simulation.</p>
<p>Items in <code>$FIXED</code> will not be shown when parameters are queried.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> CL <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> VC <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> FIXED <span class="op">]</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="fl">9.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Annotated example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>$FIXED @annotated</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">:</span> <span class="fl">9.8</span> <span class="op">:</span> Acceleration due to gravity <span class="op">(</span>m<span class="op">/</span>s<span class="op">^</span><span class="dv">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See also: <a href="#sec-block-param" class="quarto-xref"><span>Section 2.2.4</span></a> and <a href="#sec-block-theta" class="quarto-xref"><span>Section 2.2.23</span></a>.</p>
<p>Notes:</p>
<ul>
<li>Multiple blocks are allowed</li>
<li>Values are evaluated by the <code>R</code> interpreter</li>
</ul>
</section>
<section id="cmt-and-init" class="level3" data-number="2.2.7">
<h3 data-number="2.2.7" class="anchored" data-anchor-id="cmt-and-init"><span class="header-section-number">2.2.7</span> <code>$CMT</code> and <code>$INIT</code></h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@object</code>, <code>@as_object</code></p>
<p>Declare the names of all compartments in the model.</p>
<ul>
<li>For <code>$CMT</code> give the names of compartments; initial values are assumed to be 0</li>
<li>For <code>$INIT</code> give the name and initial value for all compartments</li>
</ul>
<p>Note that both <code>$CMT</code> and <code>$INIT</code> declare compartments, so any compartment name should get declared in either <code>$CMT</code> or <code>$INIT</code>, but never both.</p>
<p>Examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> CMT <span class="op">]</span> GUT CENT RESPONSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> INIT <span class="op">]</span> GUT  <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> CENT <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> RESPONSE <span class="op">=</span> <span class="dv">25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Annotated examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> CMT <span class="op">]</span> @annotated</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>GUT      <span class="op">:</span> Dosing compartment <span class="op">(</span>mg<span class="op">)</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>CENT     <span class="op">:</span> Central PK compartment <span class="op">(</span>mg<span class="op">)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>RESPONSE <span class="op">:</span> Response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>$INIT @annotated</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>GUT      <span class="op">:</span>   <span class="dv">0</span> <span class="op">:</span> Dosing compartment <span class="op">(</span>mg<span class="op">)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>CENT     <span class="op">:</span>   <span class="dv">0</span> <span class="op">:</span> Central PK compartment <span class="op">(</span>mg<span class="op">)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>RESPONSE <span class="op">:</span>  <span class="dv">25</span> <span class="op">:</span> Response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>@object</code> and <code>@as_object</code> options should name or return a named list of compartments and initial values when used in <code>$INIT</code> and a character vector of compartment names when used in <code>$CMT</code>.</p>
<p>See <code>?init</code> in the <code>R</code> help system after loading mrgsolve.</p>
</section>
<section id="sec-block-main" class="level3" data-number="2.2.8">
<h3 data-number="2.2.8" class="anchored" data-anchor-id="sec-block-main"><span class="header-section-number">2.2.8</span> <code>$MAIN</code> &nbsp;</h3>
<p><strong>Syntax</strong>: C++<br>
<strong>Multiple allowed</strong>: no</p>
<p>This code block has two main purposes:</p>
<ul>
<li>Derive new algebraic relationships between parameters, random, effects and other derived variables</li>
<li>Set the initial conditions for model compartments</li>
</ul>
<p>For users who are familiar with NONMEM, <code>$MAIN</code> is similar to <code>$PK</code>.</p>
<p><code>$MAIN</code> is wrapped into a <code>C++</code> function and compiled / loaded by mrgsolve.<br>
The <code>MAIN</code> function gets called just prior to advancing the system from the current time to the next time for each record in the data set. <code>$MAIN</code> also gets called several times before starting the problem (<code>NEWIND == 0</code>) and just prior to simulating each individual (<code>NEWIND == 1</code>). Finally, <code>$MAIN</code> gets called every time the model initial conditions are queried with <code>init()</code>.</p>
<p>New variables may be declared in <code>$MAIN</code>. See <a href="#sec-new-variables" class="quarto-xref"><span>Section 2.5</span></a> for details.</p>
<p>Examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> CMT <span class="op">]</span> CENT RESP</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> KIN <span class="op">=</span> <span class="dv">100</span><span class="op">,</span> KOUT <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> VC <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> MAIN <span class="op">]</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>RESP_0 <span class="op">=</span> KIN<span class="op">/</span>KOUT<span class="op">;</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> ke <span class="op">=</span> CL<span class="op">/</span>VC<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-block-pk" class="level3" data-number="2.2.9">
<h3 data-number="2.2.9" class="anchored" data-anchor-id="sec-block-pk"><span class="header-section-number">2.2.9</span> <code>$PK</code> &nbsp;</h3>
<p>This is an alias for <code>$MAIN</code>.</p>
</section>
<section id="sec-block-ode" class="level3" data-number="2.2.10">
<h3 data-number="2.2.10" class="anchored" data-anchor-id="sec-block-ode"><span class="header-section-number">2.2.10</span> <code>$ODE</code> &nbsp;</h3>
<p><strong>Syntax</strong>: C++<br>
<strong>Multiple allowed</strong>: no<br>
<strong>Options</strong>: <code>@param</code></p>
<p>Use <code>$ODE</code> to define model differential equations. For all compartments assign the value of the differential equation to <code>dxdt_CMT</code> where <code>CMT</code> is the name of the compartment. The <code>dxdt_</code> equation may be a function of model parameters (via <code>$PARAM</code>), the current value of any compartment (<code>CMT</code>) or any user-derived variable.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> CMT <span class="op">]</span> GUT CENT</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> ODE <span class="op">]</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>dxdt_GUT <span class="op">=</span> <span class="op">-</span>KA<span class="op">*</span>GUT<span class="op">;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>dxdt_CENT <span class="op">=</span> KA<span class="op">*</span>GUT <span class="op">-</span> KE<span class="op">*</span>CENT<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is important to make sure that there is a <code>dxdt_</code> expression defined for every compartment listed in <code>$CMT</code> or <code>$INIT</code>, even if it is <code>dxdt_CMT = 0;</code></p>
<p>The <code>$ODE</code> function is called repeatedly during a simulation run. So it is wise to do as many calculations as possible outside of <code>$ODE</code>, usually in <code>$MAIN</code>. But remember that any calculation that depends on an amount in a compartment and helps determine the <code>dxdt_</code> expression in a model must be written in <code>$ODE</code>.</p>
<p>New variables may be declared in <code>$ODE</code>. See <a href="#sec-new-variables" class="quarto-xref"><span>Section 2.5</span></a> for details.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>$CMT CENT RESP</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>$PARAM VC <span class="op">=</span> <span class="dv">100</span><span class="op">,</span> KE <span class="op">=</span> <span class="fl">0.2</span><span class="op">,</span> KOUT <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> KIN <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>$ODE</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CP <span class="op">=</span> CENT<span class="op">/</span>VC<span class="op">;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> INH <span class="op">=</span> CP<span class="op">/(</span>IMAX<span class="op">+</span>CP<span class="op">)</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>dxdt_CENT <span class="op">=</span> <span class="op">-</span>KE<span class="op">*</span>CENT<span class="op">;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>dxdt_RESP <span class="op">=</span>  KIN<span class="op">*(</span><span class="dv">1</span> <span class="op">-</span> INH<span class="op">)</span> <span class="op">-</span> RESP<span class="op">*</span>KOUT<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the model needs to refer to the current time, use the <code>SOLVERTIME</code> variable.</p>
<p>Notes:</p>
<ul>
<li><code>$ODE</code> is written in <code>C++</code> syntax; every line must end in <code>;</code></li>
<li>There may be only one <code>$ODE</code> block in a model</li>
</ul>
</section>
<section id="sec-block-des" class="level3" data-number="2.2.11">
<h3 data-number="2.2.11" class="anchored" data-anchor-id="sec-block-des"><span class="header-section-number">2.2.11</span> <code>$DES</code> &nbsp;</h3>
<p>This is an alias for <code>$ODE</code>.</p>
</section>
<section id="sec-block-table" class="level3" data-number="2.2.12">
<h3 data-number="2.2.12" class="anchored" data-anchor-id="sec-block-table"><span class="header-section-number">2.2.12</span> <code>$TABLE</code> &nbsp;</h3>
<p><strong>Syntax</strong>: C++<br>
<strong>Multiple allowed</strong>: no</p>
<p>Use <code>$TABLE</code> to interact with parameters, compartment values, and other user-defined variables <strong>after</strong> the system advances to the next time.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> TABLE <span class="op">]</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CP <span class="op">=</span> CENT<span class="op">/</span>VC<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>NOTE</strong> mrgsolve formerly had a <code>table()</code> macro for inserting derived values into simulated output. This macro has been deprecated. The only way to insert derived values into the simulated output is via <code>$CAPTURE</code>.</p>
<p><strong>NOTE</strong> When variables are marked for capture (see <a href="#sec-block-capture" class="quarto-xref"><span>Section 2.2.16</span></a>), the values of those variables are saved at the <strong>end</strong> of the <code>$TABLE</code> function. This process is carried out automatically by mrgsolve and therefore requires no user intervention.</p>
</section>
<section id="sec-block-error" class="level3" data-number="2.2.13">
<h3 data-number="2.2.13" class="anchored" data-anchor-id="sec-block-error"><span class="header-section-number">2.2.13</span> <code>$ERROR</code> &nbsp;</h3>
<p>This is an alias for <code>$TABLE</code>.</p>
</section>
<section id="sec-block-preamble" class="level3" data-number="2.2.14">
<h3 data-number="2.2.14" class="anchored" data-anchor-id="sec-block-preamble"><span class="header-section-number">2.2.14</span> <code>$PREAMBLE</code> &nbsp;</h3>
<p><strong>Syntax</strong>: C++<br>
<strong>Multiple allowed</strong>: no</p>
<p>This is the fourth C++ code block. It is called once in two different settings (<a href="sequence.html" class="quarto-xref"><span>Chapter 7</span></a>):</p>
<ol type="1">
<li>Immediately prior to starting the simulation run</li>
<li>Immediately prior to calling <code>$MAIN</code> when calculating initial conditions</li>
</ol>
<p><code>$PREAMBLE</code> is a function that allows you to set up your C++ environment. It is only called one time during the simulation run (right at the start). The code in this block is typically used to configure or initialize C++ variables or data structures that were declared in <code>$GLOBAL</code>.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PLUGIN <span class="op">]</span> Rcpp</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> GLOBAL <span class="op">]</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>namespace<span class="op">{</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  Rcpp<span class="op">::</span>NumericVector x<span class="op">;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PREAMBLE <span class="op">]</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>push_back<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>push_back<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>push_back<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> MAIN <span class="op">]</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>some code that uses x vector<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, we want to use a numeric vector <code>x</code> and declare it in <code>$GLOBAL</code> so that we can use it anywhere else in the code (the declaration is also made in an unnamed namespace to ensure that the variable is local to the model file). Then, in <code>$PREAMBLE</code>, we put 3 numbers into the vector and we use <code>x</code> in <code>$MAIN</code>. Since <code>$MAIN</code>, <code>$TABLE</code> and (especially) <code>$ODE</code> are called repeatedly as the simulation run progresses, we put the initialization of <code>x</code> in <code>$PREAMBLE</code> to make sure the initialization of <code>x</code> only happens once.</p>
<p>Notes:</p>
<ul>
<li><code>$PREAMBLE</code> is written in <code>C++</code> syntax; every line must end in <code>;</code></li>
<li>There may be only one <code>$PREAMBLE</code> block in a model</li>
<li>Like <code>$MAIN</code>, <code>$ODE</code> and <code>$TABLE</code>, <code>double</code>, <code>int</code> and <code>bool</code> variables initialized in <code>$PREAMBLE</code> are actually initialized for global (within the model file)</li>
</ul>
<p>See also: <a href="sequence.html" class="quarto-xref"><span>Chapter 7</span></a> and <a href="#sec-block-plugin" class="quarto-xref"><span>Section 2.2.22</span></a>.</p>
</section>
<section id="sec-block-pred" class="level3" data-number="2.2.15">
<h3 data-number="2.2.15" class="anchored" data-anchor-id="sec-block-pred"><span class="header-section-number">2.2.15</span> <code>$PRED</code> &nbsp;</h3>
<p><strong>Syntax</strong>: C++<br>
<strong>Multiple allowed</strong>: no</p>
<p>Use <code>$PRED</code> to write a model without differential equations. In this block, write all algebraic expressions for derived parameters, the response, and any other derived output quantities.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> TVE0 <span class="op">=</span> <span class="dv">100</span><span class="op">,</span> AUC50 <span class="op">=</span> <span class="dv">100</span><span class="op">,</span> IMAX <span class="op">=</span> <span class="dv">40</span><span class="op">,</span> AUC <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PRED <span class="op">]</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> E0 <span class="op">=</span> EVE0<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> RESP <span class="op">=</span> E0 <span class="op">-</span> IMAX<span class="op">*</span>AUC<span class="op">/(</span>AUC50<span class="op">+</span>AUC<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, the entire model is written in the <code>$PRED</code> block. It is an error to include the following blocks when <code>$PRED</code> is being used: <code>$MAIN</code>, <code>$TABLE</code>, <code>$PKMODEL</code>, <code>$ODE</code>, <code>$CMT</code>, <code>$INIT</code>.</p>
<p>See <a href="datasets.html#sec-pred-data" class="quarto-xref"><span>Section 3.7</span></a> for additional information regarding data sets in use with <code>$PRED</code> block.</p>
</section>
<section id="sec-block-capture" class="level3" data-number="2.2.16">
<h3 data-number="2.2.16" class="anchored" data-anchor-id="sec-block-capture"><span class="header-section-number">2.2.16</span> <code>$CAPTURE</code> &nbsp;</h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@etas</code></p>
<p>This is a block to identify variables that should be captured in the simulated output. The <code>@etas</code> option is new with version 1.0.8.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> A <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> B <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> MAIN <span class="op">]</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> C <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> yes <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> CAPTURE <span class="op">]</span> A B C yes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This construct will result in four additional columns in the simulated output with names <code>A</code>, <code>B</code>, <code>C</code>, and <code>yes</code>.</p>
<p>Users can also rename captured variables by providing a <code>newname = oldname</code> specification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>$PARAM WT <span class="op">=</span> <span class="dv">70</span><span class="op">,</span> THETA1 <span class="op">=</span> <span class="fl">2.2</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CL <span class="op">=</span> THETA1<span class="op">*</span>pow<span class="op">(</span>WT<span class="op">/</span><span class="dv">70</span><span class="op">,</span><span class="fl">0.75</span><span class="op">)*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>$OMEGA <span class="dv">1</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>$CAPTURE WEIGHT <span class="op">=</span> WT TVCL <span class="op">=</span> THETA2 CL  ETA<span class="op">(</span><span class="dv">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, the names of the captured data items will be <code>WEIGHT,TVCL,CL,ETA_1</code>.</p>
<p>Users can use the <code>capture</code> type to declare variables in <code>$MAIN</code> and <code>$TABLE</code>. <code>capture</code> types are really <code>double</code>s, but using that type will signal mrgsolve to automatically capture that value. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>$PARAM VC <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>$CMT CENT</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>capture DV <span class="op">=</span> <span class="op">(</span>CENT<span class="op">/</span>VC<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we used type <code>capture</code> for <code>DV</code>, <code>DV</code> will show up as a column in the simulated data.</p>
<p>Annotated example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CLi <span class="op">=</span> TVCL<span class="op">*</span>exp<span class="op">(</span>ECL<span class="op">);</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> DV <span class="op">=</span> <span class="op">(</span>CENT<span class="op">/</span>VC<span class="op">)*</span>exp<span class="op">(</span>PROP<span class="op">);</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>$CAPTURE @annotated</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>CLi <span class="op">:</span> Individual clearance <span class="op">(</span>L<span class="op">/</span>hr<span class="op">)</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>DV  <span class="op">:</span> Plasma concentration <span class="op">(</span>mcg<span class="op">/</span>ml<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use the <code>@etas</code> option to specify an expression that evaluates to integers which identify the <code>ETA</code> number(s) to capture. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>$OMEGA <span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>$CAPTURE @etas <span class="dv">1</span><span class="op">:</span>LAST</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>CL DV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Will capture all three <code>ETA</code>s into the simulation outputs. NONMEM-style names will be used (e.g.&nbsp;<code>ETA1</code>). This is in contrast to the names that are generated when <code>ETA(1)</code> is captured; in this case, the parens are removed and replaced with <code>_</code> so the output name is <code>ETA_1</code>. mrgsolve will provide <code>LAST</code> (and <code>last</code>) which will evaluate to the maximum number of <code>ETAs</code> in the problem (in this case, 3). You can write any valid expression in <code>@etas</code>. When the expression is evaluated, it will be evaluated in the model environment created through the <code>$ENV</code> block (<a href="#sec-block-env" class="quarto-xref"><span>Section 2.2.27</span></a>).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In addition to listing model variables for output in the <code>$CAPTURE</code> block, users can “dynamically” capture model variables through the <code>capture</code> argument to <a href="https://mrgsolve.org/docs/reference/mread.html"><code>mread()</code></a>. These may be model parameters (listed in <code>$PARAM</code>) or user-defined model variables.</p>
<p>To get a listing of available user-defined variables, you can use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">house</span>()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(mod)<span class="sc">$</span>cpp_variables</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="sec-block-omega" class="level3" data-number="2.2.17">
<h3 data-number="2.2.17" class="anchored" data-anchor-id="sec-block-omega"><span class="header-section-number">2.2.17</span> <code>$OMEGA</code> &nbsp;</h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@block</code>, <code>@correlation</code>, <code>@labels</code>, <code>@name</code>, <code>@object</code>, <code>@as_object</code></p>
<p>See <code>?modMATRIX</code> for more details about options for this block.</p>
<p>Use this block to enter variance/covariance matrices for subject-level random effects drawn from multivariate normal distribution. All random effects are assumed to have mean of 0. Off diagonal elements for block matrices are assumed to be correlation coefficients if the <code>@correlation</code> option is used (see below).</p>
<p>By default, a <strong>diagonal</strong> matrix is assumed. So:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>$OMEGA</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>will generate a 3x3 omega matrix.</p>
<p>A <strong>block</strong> matrix may be entered by using <code>block = TRUE</code>. So:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @block</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="fl">0.02</span> <span class="fl">0.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>will generate a 2x2 matrix with covariance 0.02.</p>
<p>A 2x2 matrix where the off-diagonal element is a correlation, not a covariance can be specified like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @correlation</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="fl">0.67</span> <span class="fl">0.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the correlation is 0.67. mrgsolve will calculate the covariances and substitute these values. The matrix will be stored and used with these covariances, not the correlation.</p>
<p>A name can be assigned to each matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @name PK @block</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.2</span> <span class="fl">0.02</span> <span class="fl">0.3</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>$OMEGA @name PD</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span> <span class="fl">0.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>to distinguish between multiple <code>$OMEGA</code> blocks and to facilitate updating later. The model in the preceding example will have two <code>$OMEGA</code> matrices: 2x2 and 4x4.</p>
<p>Labels can be assigned which function as aliases for the different <code>ETAs</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @block @labels ETA_CL ETA_V</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="fl">0.05</span> <span class="fl">0.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The number of labels should match the number of rows (or columns) in the matrix.</p>
<p>Annotated example (diagonal matrix):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @annotated</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ECL<span class="op">:</span> <span class="fl">0.09</span> <span class="op">:</span> ETA on clearance</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>EVC<span class="op">:</span> <span class="fl">0.19</span> <span class="op">:</span> ETA on volume</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>EKA<span class="op">:</span> <span class="fl">0.45</span> <span class="op">:</span> ETA on absorption rate constant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Annotated example (block matrix):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @annotated @block</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ECL<span class="op">:</span> <span class="fl">0.09</span> <span class="op">:</span> ETA on clearance</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>EVC<span class="op">:</span> <span class="fl">0.001</span> <span class="fl">0.19</span> <span class="op">:</span> ETA on volume</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>EKA<span class="op">:</span> <span class="fl">0.001</span> <span class="fl">0.001</span> <span class="fl">0.45</span> <span class="op">:</span> ETA on absorption rate constant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>@object</code> and <code>@as_object</code> options should name or return a square numeric matrix. If <code>rownames</code> are included in the matrix, then they will be used to form labels for the realized ETAs. For example, we can initialize a very large <code>$OMEGA</code> matrix with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @as_object</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">&lt;-</span> <span class="dv">20</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>lbl <span class="op">&lt;-</span> paste0<span class="op">(</span><span class="st">"ETA_"</span><span class="op">,</span> LETTERS<span class="op">[</span><span class="dv">1</span><span class="op">:</span>n<span class="op">])</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>matrix<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> dimnames <span class="op">=</span> list<span class="op">(</span>lbl<span class="op">,</span> lbl<span class="op">))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: this only initializes the matrix; you will (likely) need to update it with meaningful values after the model is loaded (<a href="matrix.html" class="quarto-xref"><span>Chapter 5</span></a>).</p>
</section>
<section id="sec-block-sigma" class="level3" data-number="2.2.18">
<h3 data-number="2.2.18" class="anchored" data-anchor-id="sec-block-sigma"><span class="header-section-number">2.2.18</span> <code>$SIGMA</code> &nbsp;</h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@block</code>, <code>@correlation</code>, <code>@labels</code>, <code>@name</code>, <code>@object</code>, <code>@as_object</code></p>
<p>See <code>?modMATRIX</code> for more details about options for this block.</p>
<p>Use this block to enter variance/covariance matrices for within-subject random effects drawn from multivariate normal distribution. All random effects are assumed to have mean of 0. Off diagonal elements for block matrices are assumed to be correlation coefficients if the <code>@correlation</code> option is used (see below).</p>
<p>The <code>@object</code> and <code>@as_object</code> options should name or return a square numeric matrix. If <code>rownames</code> are included in the matrix, then they will be used to form labels for the realized EPS values.</p>
<p>The <code>$SIGMA</code> block functions like the <code>$OMEGA</code> block. See <code>$OMEGA</code> for details.</p>
</section>
<section id="sec-block-set" class="level3" data-number="2.2.19">
<h3 data-number="2.2.19" class="anchored" data-anchor-id="sec-block-set"><span class="header-section-number">2.2.19</span> <code>$SET</code></h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: no</p>
<p>Use this code block to set different options for the simulation. Use a <code>name = value</code> format, where <code>value</code> is evaluated by the <code>R</code> interpreter.</p>
<p>Most of the options that can be entered in <code>$SET</code> are passed to <code>update</code>.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> SET <span class="op">]</span> end <span class="op">=</span> <span class="dv">240</span><span class="op">,</span> delta <span class="op">=</span> <span class="fl">0.5</span><span class="op">,</span> req <span class="op">=</span> <span class="st">"RESP"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we set the simulation <code>end</code> time to 240, set the time difference between two adjacent time points to 0.25 time units, and request only the <code>RESP</code> compartment in the simulated output.</p>
</section>
<section id="global" class="level3" data-number="2.2.20">
<h3 data-number="2.2.20" class="anchored" data-anchor-id="global"><span class="header-section-number">2.2.20</span> <code>$GLOBAL</code></h3>
<p><strong>Syntax</strong>: C++<br>
<strong>Multiple allowed</strong>: no</p>
<p>The <code>$GLOBAL</code> block is for writing <code>C++</code> code that is outside of <code>$MAIN</code>, <code>$ODE</code>, and <code>$TABLE</code>.</p>
<p>There are no artificial limit on what sort of <code>C++</code> code can go in <code>$GLOBAL</code>.<br>
However there are two more-common uses:</p>
<ol type="1">
<li>Write <code>#define</code> preprocessor statements</li>
<li>Define global variables, usually variables other than <code>double</code>, <code>bool</code>, <code>int</code> (see <a href="#sec-new-variables" class="quarto-xref"><span>Section 2.5</span></a>)</li>
</ol>
<p><strong>Preprocessor directives</strong> Preprocessor <code>#define</code> directives are direct substitutions that the <code>C++</code> preprocessor makes prior to compiling your code.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> GLOBAL <span class="op">]</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CP </span><span class="op">(</span><span class="pp">CENT</span><span class="op">/</span><span class="pp">VC</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When this preprocessor directive is included, everywhere the preprocessor finds a <code>CP</code> token it will substitute <code>(CENT/VC)</code>. Both <code>CENT</code> and <code>VC</code> must be defined and the ratio of <code>CENT</code> to <code>VC</code> will be calculated depending on whatever the current values are. Notice that we included parentheses around <code>(CENT/VC)</code>.<br>
This makes sure the ratio between the two is taken first, before any other operations involving <code>CP</code>.</p>
<p><strong>Declaring global variables</strong> Sometimes, you may wish to use global variables and have more control over how they get declared.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>$GLOBAL</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> cure <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this construct, the boolean variable <code>cure</code> is declared and defined right as the model is compiled.</p>
<p><strong>Declare in bulk</strong></p>
<p>If you have a large number of variables to declare, you can do that in bulk in <code>$GLOBAL</code>. For example, we know we will need a long list of <code>double</code> precision variable for covariate modeling, we can declare them all at once like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> global <span class="op">]</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> TVCL<span class="op">,</span> TVV2<span class="op">,</span> TVQ <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> TVV3 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> main <span class="op">]</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>TVCL <span class="op">=</span> THETA1 <span class="op">*</span> pow<span class="op">(</span>WT <span class="op">/</span> <span class="fl">70.0</span><span class="op">,</span> <span class="fl">0.75</span><span class="op">);</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>TVV2 <span class="op">=</span> THETA2 <span class="op">*</span> WT <span class="op">/</span> <span class="fl">70.0</span><span class="op">;</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>TVQ  <span class="op">=</span> THETA3 <span class="op">*</span> pow<span class="op">(</span>WT <span class="op">/</span> <span class="fl">70.0</span><span class="op">,</span> <span class="fl">0.75</span><span class="op">);</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>TVV3 <span class="op">=</span> THETA4 <span class="op">*</span> WT <span class="op">/</span> <span class="fl">70.0</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This isn’t a terribly long list, but let’s pretend it is to illustrate how to do this. You can also declare <code>int</code>, <code>bool</code> and other types like this. I’ve initialized the last two (<code>TVVQ</code> and <code>TVV3</code>) to illustrate how to do this. It’s good practice to do that but not necessary as long as everything gets initialized to <strong>something</strong> before they are used.</p>
</section>
<section id="pkmodel" class="level3" data-number="2.2.21">
<h3 data-number="2.2.21" class="anchored" data-anchor-id="pkmodel"><span class="header-section-number">2.2.21</span> <code>$PKMODEL</code></h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: no</p>
<p>This code block implements a one- or two-compartment PK model where the system is calculated by algebraic equations, not ODEs. mrgsolve handles the calculations and an error is generated if both <code>$PKMODEL</code> and <code>$ODE</code> blocks are included in the same model specification file.</p>
<p>This is an options-only block. The user must specify the number of compartments (1 or 2) to use in the model as well as whether or not to include a depot dosing compartment. See <code>?PKMODEL</code> for more details about this block, including specific requirements for symbols that must be defined in the model specification file.</p>
<p>The <code>$CMT</code> or <code>$INIT</code> block must also be included with an appropriate number of compartments. Compartment names, however, may be determined by the user.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> CMT <span class="op">]</span> GUT CENT PERIPH</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PKMODEL <span class="op">]</span> ncmt<span class="op">=</span><span class="dv">2</span><span class="op">,</span> depot<span class="op">=</span>TRUE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As of version <code>0.8.2</code>, we can alternatively specify the compartments right in the <code>$PKMODEL</code> block:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>$PKMODEL cmt<span class="op">=</span><span class="st">"GUT CENT PERIPH"</span><span class="op">,</span> depot <span class="op">=</span> TRUE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Specifying three compartments with <code>depot=TRUE</code> implies <code>ncmt=2</code>. Notice that a separate <code>$CMT</code> block is not appropriate when <code>cmt</code> is specified in <code>$PKMODEL</code>.</p>
</section>
<section id="sec-block-plugin" class="level3" data-number="2.2.22">
<h3 data-number="2.2.22" class="anchored" data-anchor-id="sec-block-plugin"><span class="header-section-number">2.2.22</span> <code>$PLUGIN</code> &nbsp;</h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: no</p>
<p>Plugins are a way to add extensions to your mrgsolve model. Plugins can either link your model to external libraries (like <code>boost</code> or <code>Rcpp</code>) or they can open up access to additional functionality provided by mrgsolve itself.</p>
<p>Plugins are listed and discussed in more detail in <a href="plugins.html" class="quarto-xref"><span>Chapter 9</span></a>.</p>
<p><strong>Usage</strong></p>
<p>To invoke a plugin, list the plugin name in the code block. For requesting <code>Rcpp</code> headers in your model, call</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN Rcpp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Available plugins</strong></p>
<p>The following plugins make additional mrgsolve-specific functionality available</p>
<ul>
<li><code>mrgx</code>: extra <code>C++</code> functions (see below)</li>
<li><code>tad</code>: track time after dose in your model</li>
<li><code>N_CMT</code>: get the number of a compartment</li>
</ul>
<p>The following plugins give you a different model specification experience</p>
<ul>
<li><code>autodec</code>: mrgsolve will find assignments in your model and automatically declare them as <code>double</code>s</li>
<li><code>nm-vars</code>: a NONMEM look and feel for compartmental models; use <code>F1</code>, <code>A(1)</code> and <code>DADT(1)</code> rather than <code>F_GUT</code>, <code>GUT</code> and <code>dxdt_GUT</code></li>
</ul>
<p>The following plugin lets you customize how your model is compiled</p>
<ul>
<li><code>CXX11</code>: compile your model with <code>C++11</code> standard; this adds the compiler flag <code>-std=c++11</code></li>
</ul>
<p>The following plugins will let you link to external libraries</p>
<ul>
<li><code>Rcpp</code>: include <code>Rcpp</code> headers int your model</li>
<li><code>BH</code>: include <code>boost</code> headers in your model</li>
<li><code>RcppArmadillo</code>: include <code>Armadillo</code> headers in your model</li>
</ul>
<p>Note that <code>Rcpp</code>, <code>RcppArmadillo</code> and <code>BH</code> only allow you to link to those headers. To take advantage of that, you will need to know how to use <code>Rcpp</code>, <code>boost</code> etc. For the <code>BH</code> plugin, no headers are included for you; you must include the proper headers you want to use in <code>$GLOBAL</code>.</p>
<p><strong>mrgx</strong> This is a general collection of functions that we made available.</p>
<p>Functions provided by <code>mrgx</code>:</p>
<ul>
<li><code>T get&lt;T&gt;(std::string &lt;pkgname&gt;, std::string &lt;objectname&gt;)</code>
<ul>
<li>This gets an object of any Rcpp-representable type (<code>T</code>) from any package</li>
</ul></li>
<li><code>T get&lt;T&gt;(std::string &lt;objectname)</code>
<ul>
<li>This gets an object of any Rcpp-representable type (<code>T</code>) from <code>.GlobalEnv</code></li>
</ul></li>
<li><code>T get&lt;T&gt;(std::string &lt;objectname&gt;, databox&amp; self)</code>
<ul>
<li>This gets an object of any Rcpp-representable type (<code>T</code>) from <code>$ENV</code></li>
</ul></li>
<li><code>double rnorm(double mean, double sd, double min, double max)</code>
<ul>
<li>Simulate one variate from a normal distribution that is between <code>min</code> and <code>max</code></li>
</ul></li>
<li><code>double rlognorm(double mean, double sd, double min, double max)</code>
<ul>
<li>Same as <code>mrgx::rnorm</code>, but the simulated value is passed to <code>exp</code> after simulating</li>
</ul></li>
<li><code>Rcpp::Function mt_fun()</code>
<ul>
<li>Returns <code>mrgsolve::mt_fun</code>; this is usually used when declaring a <code>R</code> function in <code>$GLOBAL</code></li>
<li>Example: <code>Rcpp::Function print = mrgx::mt_fun();</code></li>
</ul></li>
</ul>
<p><strong>IMPORTANT</strong> All of these functions are in the <code>mrgx</code> namespace. So, in order to call these functions you must include <code>mrgx::</code> namespace identifier to the front of the function name. For example, don’t use <code>rnorm(50,20,40,140)</code>; use <code>mrgx::rnorm(50,20,40,140)</code>.</p>
<section id="some-examples" class="level4" data-number="2.2.22.1">
<h4 data-number="2.2.22.1" class="anchored" data-anchor-id="some-examples"><span class="header-section-number">2.2.22.1</span> Some examples</h4>
<p><strong>Get a numeric vector from <code>$ENV</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PLUGIN <span class="op">]</span> Rcpp mrgx</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> ENV <span class="op">]</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">&lt;-</span> c<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">5</span><span class="op">)</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> GLOBAL <span class="op">]</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericVector x<span class="op">;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PREAMBLE <span class="op">]</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> mrgx<span class="op">::</span>get<span class="op">&lt;</span>Rcpp<span class="op">::</span>NumericVector<span class="op">&gt;(</span><span class="st">"x"</span><span class="op">,</span> self<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Get the <code>print</code> function from <code>package:base</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN Rcpp mrgx</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>$GLOBAL</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>Rcpp<span class="op">::</span>Function print <span class="op">=</span> mrgx<span class="op">::</span>mt_fun<span class="op">();</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>$PREAMBLE</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>print <span class="op">=</span> mrgx<span class="op">::</span>get<span class="op">&lt;</span>Rcpp<span class="op">::</span>Function<span class="op">&gt;(</span><span class="st">"base"</span><span class="op">,</span> <span class="st">"print"</span><span class="op">);</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>print<span class="op">(</span>self<span class="op">.</span>rown<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we declare the <code>print</code> in <code>$GLOBAL</code> and use the <code>mt_fun()</code> place holder.</p>
<p><strong>Simulate truncated normal variables</strong> This simulates a weight that has mean 80, standard deviation 20 and is greater than 40 and less than 140.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN Rcpp mrgx</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>NEWIND <span class="op">&lt;=</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> WT <span class="op">=</span> mrgx<span class="op">::</span>rnorm<span class="op">(</span><span class="dv">80</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span><span class="dv">40</span><span class="op">,</span><span class="dv">140</span><span class="op">);</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See also: <a href="#sec-block-preamble" class="quarto-xref"><span>Section 2.2.14</span></a>.</p>
</section>
</section>
<section id="sec-block-theta" class="level3" data-number="2.2.23">
<h3 data-number="2.2.23" class="anchored" data-anchor-id="sec-block-theta"><span class="header-section-number">2.2.23</span> <code>$THETA</code> &nbsp;</h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: yes<br>
<strong>Options</strong>: <code>@annotated</code>, <code>@name</code>, <code>@object</code>, <code>@as_object</code></p>
<p>Use this code block as an efficient way to add to the parameter list where names are determined by a prefix and a number. By default, the prefix is <code>THETA</code> and the number sequentially numbers the input values.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> THETA <span class="op">]</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>is equivalent to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>$PARAM THETA1 <span class="op">=</span> <span class="fl">0.1</span><span class="op">,</span> THETA2 <span class="op">=</span> <span class="fl">0.2</span><span class="op">,</span> THETA3 <span class="op">=</span> <span class="fl">0.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Annotated example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>$THETA @annotated</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="op">:</span> Typical value of clearance <span class="op">(</span>L<span class="op">/</span>hr<span class="op">)</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fl">0.2</span> <span class="op">:</span> Typical value of volume <span class="op">(</span>L<span class="op">)</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fl">0.3</span> <span class="op">:</span> Typical value of ka <span class="op">(</span><span class="dv">1</span><span class="op">/</span>hr<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To change the prefix, use <code>@name</code> option</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>$THETA @name theta</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>would be equivalent to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> theta1 <span class="op">=</span> <span class="fl">0.1</span><span class="op">,</span> theta2 <span class="op">=</span> <span class="fl">0.2</span><span class="op">,</span> theta3 <span class="op">=</span> <span class="fl">0.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>@object</code> and <code>@as_object</code> options should name or return an unnamed vector of parameter values (names are ignored).</p>
<p>See also: <a href="#sec-block-param" class="quarto-xref"><span>Section 2.2.4</span></a>.</p>
</section>
<section id="sec-block-nmxml" class="level3" data-number="2.2.24">
<h3 data-number="2.2.24" class="anchored" data-anchor-id="sec-block-nmxml"><span class="header-section-number">2.2.24</span> <code>$NMXML</code> &nbsp;</h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: yes</p>
<p>The <code>$NMXML</code> block lets you read and incorporate results from a NONMEM run into your mrgsolve model.</p>
<section id="syntax" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="syntax">Syntax</h4>
<p>If your model run is 1000 and the <code>.xml</code> file is located in <code>1000/1000.xml</code>, use this syntax</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>NMXML </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>run <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>project <span class="ot">=</span> <span class="st">"../model/nonmem"</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>root <span class="ot">=</span> <span class="st">"cppfile"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If your model run is 1000 and the <code>.xml</code> file is located in some other location use the <code>path</code> argument to specify the <em>complete</em> path to the <code>.xml</code> file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>NMXML </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"../&lt;path&gt;/&lt;to&gt;/&lt;output&gt;/&lt;files&gt;/1000.xml"</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>root <span class="ot">=</span> <span class="st">"cppfile"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This latter syntax may be needed when using PsN and output files are organized in a way different from the previous example.</p>
</section>
<section id="details" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="details">Details</h4>
<p>From the NONMEM run, <code>THETA</code> will be imported into your parameter list (see <a href="#sec-block-param" class="quarto-xref"><span>Section 2.2.4</span></a> and <a href="components.html#sec-component-param" class="quarto-xref"><span>Section 1.1</span></a>), <code>OMEGA</code> will be captured as an <code>$OMEGA</code> block (<a href="#sec-block-omega" class="quarto-xref"><span>Section 2.2.17</span></a>) and <code>SIGMA</code> will be captured as a <code>$SIGMA</code> block (<a href="#sec-block-sigma" class="quarto-xref"><span>Section 2.2.18</span></a>). Users may optionally omit any one of these from being imported.</p>
<p><code>$NMXML</code> contains a <code>project</code> argument and a <code>run</code> argument. By default, the estimates are read from from the file <code>project/run/run.xml</code>. That is, it is assumed that there is a directory named <code>run</code> that is inside the <code>project</code> directory where <code>$NMXML</code> will find <code>run.xml</code>. Your NONMEM run directories may not be organized in a way that is compatible with this default. In that case, you will need to provide the <code>path</code> argument, which should be the path to the <code>run.xml</code> file, either as a full path or as a path relative to the current working directory.</p>
<p>Once the model object is obtained, the path to the <code>xml</code> file that formed the source for imported parameters can be retrieved by coercing the model object to list and looking for <code>nm_import</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">modlib</span>(<span class="st">"1005"</span>, <span class="at">compile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(mod)<span class="sc">$</span>nm_import</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For help on the arguments / options for <code>$NMXML</code>, please see the <code>?nmxml</code> help topic in your <code>R</code> session after loading the mrgsolve package.</p>
<p><strong>An example</strong></p>
<p>There is a NONMEM run embedded in the mrgsolve package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">path.package</span>(<span class="st">"mrgsolve"</span>),<span class="st">"nonmem"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(path, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.  [1] "1005/1005.cat"    "1005/1005.coi"    "1005/1005.cor"    "1005/1005.cov"   
.  [5] "1005/1005.cpu"    "1005/1005.ctl"    "1005/1005.ext"    "1005/1005.grd"   
.  [9] "1005/1005.lst"    "1005/1005.phi"    "1005/1005.shk"    "1005/1005.shm"   
. [13] "1005/1005.tab"    "1005/1005.xml"    "1005/1005par.tab" "1005/INTER"      
. [17] "2005/2005.ext"</code></pre>
</div>
</div>
<p>We can create a mrgsolve control stream that will import <code>THETA</code>, <code>OMEGA</code> and <code>SIGMA</code> from that run using the <code>$NMXML</code> code block.</p>
<div class="cell" data-stem="nmxml-1" data-annot="true">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode c mrgsolvecode code-with-copy"><code class="sourceCode c"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">// inline/nmxml-1.cpp</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>$NMXML</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> <span class="dv">1005</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> path</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="st">"cppfile"</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>olabels <span class="op">=</span> c<span class="op">(</span><span class="st">"ECL"</span><span class="op">,</span> <span class="st">"EVC"</span><span class="op">,</span> <span class="st">"EKA"</span><span class="op">)</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>slabels <span class="op">=</span> c<span class="op">(</span><span class="st">"PROP"</span><span class="op">,</span> <span class="st">"ADD"</span><span class="op">)</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CL <span class="op">=</span> THETA1<span class="op">*</span>exp<span class="op">(</span>ECL<span class="op">);</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> V2 <span class="op">=</span> THETA2<span class="op">*</span>exp<span class="op">(</span>EVC<span class="op">);</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> KA <span class="op">=</span> THETA3<span class="op">*</span>exp<span class="op">(</span>EKA<span class="op">);</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> Q <span class="op">=</span> THETA4<span class="op">;</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> V3 <span class="op">=</span> THETA5<span class="op">;</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>$PKMODEL ncmt<span class="op">=</span><span class="dv">2</span><span class="op">,</span> depot<span class="op">=</span>TRUE</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>$CMT GUT CENT PERIPH</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CP <span class="op">=</span> <span class="op">(</span>CENT<span class="op">/</span>V2<span class="op">)*(</span><span class="dv">1</span><span class="op">+</span>PROP<span class="op">)</span> <span class="op">+</span> ADD<span class="op">/</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>$CAPTURE CP</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>$SET delta<span class="op">=</span><span class="dv">4</span><span class="op">,</span> end<span class="op">=</span><span class="dv">96</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>NOTE</strong>: in order to use this code, we need to install the <code>xml2</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mread</span>(<span class="st">"inline/nmxml-1.cpp"</span>, <span class="at">compile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>. 
. 
. ---------------  source: nmxml-1.cpp  ---------------
. 
.   project: /Users/kyleb/git...-guide/inline
.   shared object: nmxml-1.cpp-so-a7b16cd2deb7 &lt;not loaded&gt;
. 
.   time:          start: 0 end: 96 delta: 4
.                  add: &lt;none&gt;
. 
.   compartments:  GUT CENT PERIPH [3]
.   parameters:    THETA1 THETA2 THETA3 THETA4 THETA5
.                  THETA6 THETA7 [7]
.   captures:      CP [1]
.   omega:         3x3 
.   sigma:         2x2 
. 
.   solver:        atol: 1e-08 rtol: 1e-08 maxsteps: 20k
. ------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">param</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>. 
.  Model parameters (N=7):
.  name   value  . name   value
.  THETA1 9.51   | THETA5 113  
.  THETA2 22.8   | THETA6 1.02 
.  THETA3 0.0714 | THETA7 1.19 
.  THETA4 3.47   | .      .</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">revar</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>. $omega
. $...
.              [,1]        [,2]        [,3]
. ECL:   0.21387884  0.12077020 -0.01162777
. EVC:   0.12077020  0.09451047 -0.03720637
. EKA:  -0.01162777 -0.03720637  0.04656315
. 
. 
. $sigma
. $...
.              [,1]      [,2]
. PROP:  0.04917071 0.0000000
. ADD:   0.00000000 0.2017688</code></pre>
</div>
</div>
<p><strong>root argument</strong>: please use the <code>root = "cppfile"</code> argument going forward.</p>
<p>As of mrgsolve <code>0.11.0</code>, we added an argument called <code>root</code> to <code>$NMXML</code> that tells mrgsolve the location where it should read the <code>xml</code> file from. The default behavior is the <code>"working"</code> directory. When this is the case, mrgsolve assumes that the the <code>xml</code> file can be found relative to the “working” directory. The only other value that <code>root</code> can take is <code>"cppfile"</code>. When <code>root = "cppfile"</code>, then mrgsolve will look for the <code>xml</code> file in a directory that is relative to <strong>where the model source code file is located</strong>. Please take a look at <a href="#sec-block-nmext" class="quarto-xref"><span>Section 2.2.25</span></a> for more discussion and examples.</p>
<p>Starting with version 1.0.8, when the NONMEM run is found using the <code>run</code> + <code>project</code> arguments, you can pass <code>run = "@cppstem"</code> and mrgsolve will look for the NONMEM run number that matches the stem of the current mrgsolve file. For example, if you are coding a model to match NONMEM run <code>101.ctl</code>, then call your mrgsolve model file <code>101.cpp</code> or <code>101.mod</code>; just match the file stem. Then write</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>101.cpp</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>$NMXML </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> <span class="st">"@cppstem"</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> <span class="op">&lt;</span>nonmem<span class="op">-</span>run<span class="op">-</span>directory<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>mrgsolve will check the stem of the mrgsolve model file and look for the NONMEM <code>.xml</code> file in</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>nonmem<span class="sc">-</span>run<span class="sc">-</span>directory<span class="sc">&gt;</span><span class="er">/</span><span class="dv">101</span><span class="sc">/</span><span class="fl">101.</span>xml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please see the <code>?nmxml</code> help topic for more information on arguments that can be passed to <code>$NMXML</code>.</p>
<p>See also: <a href="#sec-block-nmext" class="quarto-xref"><span>Section 2.2.25</span></a>.</p>
</section>
</section>
<section id="sec-block-nmext" class="level3" data-number="2.2.25">
<h3 data-number="2.2.25" class="anchored" data-anchor-id="sec-block-nmext"><span class="header-section-number">2.2.25</span> <code>$NMEXT</code> &nbsp;</h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: yes</p>
<p>Like <code>$NMXML</code>, <code>$NMEXT</code> allows the import of <code>$THETA</code>, <code>$OMEGA</code>, and <code>$SIGMA</code> from your NONMEM run into your mrgsolve model, but the estimates are read from the <code>.ext</code> file output. <code>$NMEXT</code> is able to import the NONMEM estimates much faster than <code>$NMXML</code> when loading from sampling based methods (mainly <code>METHOD=BAYES</code>).</p>
<section id="syntax-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="syntax-1">Syntax</h4>
<p>If your model run is 1000 and the <code>.ext</code> file is located in <code>1000/1000.ext</code>, use this syntax</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>NMEXT </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>run <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>project <span class="ot">=</span> <span class="st">"../model/nonmem"</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>root <span class="ot">=</span> <span class="st">"cppfile"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If your model run is 1000 and the <code>.ext</code> file is located in some other location use the <code>path</code> argument to specify the <em>complete</em> path to the <code>.ext</code> file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>NMEXT </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"../&lt;path&gt;/&lt;to&gt;/&lt;output&gt;/&lt;files&gt;/1000.ext"</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>root <span class="ot">=</span> <span class="st">"cppfile"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This latter syntax may be needed when using PsN and output files are organized in a way different from the previous example.</p>
</section>
</section>
<section id="details-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="details-1">Details</h3>
<p>Once the model object is obtained, the path to the <code>ext</code> file that formed the source for imported parameters can be retrieved by coercing the model object to list and looking for <code>nm_import</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">modlib</span>(<span class="st">"1005"</span>, <span class="at">compile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(mod)<span class="sc">$</span>nm_import</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See the <code>$NMXML</code> topic in <a href="#sec-block-nmxml" class="quarto-xref"><span>Section 2.2.24</span></a> for an example of equivalent functionality.</p>
<p><strong>IMPORTANT</strong>: while <code>$NMEXT</code> works very similarly to <code>$NMXML</code>, there is one key difference between the two: when using <code>$NMEXT</code>, you will always get one <code>$OMEGA</code> matrix and one <code>$SIGMA</code> matrix, regardless of the block structure used in the NONMEM control stream. When using <code>$NMXML</code>, you get the same block structure in the mrgsolve model as the NONMEM model. For example: in the NONMEM control stream, <code>$OMEGA</code> is one 2x2 matrix and one 3x3 matrix. Importing those estimates with <code>$NMEXT</code> will give you one 5x5 matrix, while importing the estimates with <code>$NMXML</code> will give you a list of one 2x2 and one 3x3 matrix.</p>
<p><strong>root argument</strong>: please use the <code>root = "cppfile"</code> argument going forward.</p>
<p>As of mrgsolve <code>0.11.0</code>, we added an argument called <code>root</code> to <code>$NMEXT</code> that tells mrgsolve the location where it should read the <code>ext</code> file from. The default behavior is the <code>"working"</code> directory. When this is the case, mrgsolve assumes that the the <code>ext</code> file can be found relative to the “working” directory. The only other value that <code>root</code> can take is <code>"cppfile"</code>. When <code>root = "cppfile"</code>, then mrgsolve will look for the <code>ext</code> file in a directory that is relative to <strong>where the model source code file is located</strong>.</p>
<p>We recommend that users start using the <code>root</code> argument and set it to “cppfile”. This will eventually become the default. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>$NMEXT</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> <span class="dv">1005</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> <span class="st">"../../model/pk"</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="st">"cppfile"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This tells mrgsolve to find the nonmem run back two directories (<code>../../</code>) and then into <code>model --&gt; pk --&gt; 1005</code> relative to where the mrgsolve model file is located. This is in contrast to the previous expected behavior that the path should be relative to the current working directory.</p>
<p>We also note here that when users pass an absolute path, the relative path doesn’t matter at all. Users are free to use pathing tools to generate the absolute path to the project. For example, the <code>here::here()</code> function can be used like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>$NMEXT</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> <span class="dv">1005</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> here<span class="op">::</span>here<span class="op">(</span><span class="st">"model/pk"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When used in the proper context, <code>here()</code> will generate an absolute path from your projects root directory to the nonmem project directory. Please refer to the <code>here::here()</code> documentation for proper use of this function.</p>
<p>Starting with version 1.0.8, when the NONMEM run is found using the <code>run</code> + <code>project</code> arguments, you can pass <code>run = "@cppstem"</code> and mrgsolve will look for the NONMEM run number that matches the stem of the current mrgsolve file. See details and example in <a href="#sec-block-nmxml" class="quarto-xref"><span>Section 2.2.24</span></a>.</p>
<p>See the <code>?nmext</code> R help topic for arguments that can be passed to <code>$NMEXT</code> block. Notably, the user can select the function to read in the ext file.By default, mrgsolve will try to load data.table and use the <code>fread</code> function. If data.table can’t be loaded, then mrgsolve will use <code>utils::read.table</code>.</p>
<p>See also: <a href="#sec-block-nmxml" class="quarto-xref"><span>Section 2.2.24</span></a>.</p>
</section>
<section id="sec-block-include" class="level3" data-number="2.2.26">
<h3 data-number="2.2.26" class="anchored" data-anchor-id="sec-block-include"><span class="header-section-number">2.2.26</span> <code>$INCLUDE</code> &nbsp;</h3>
<p><strong>Syntax</strong>: text<br>
<strong>Multiple allowed</strong>: no</p>
<p>To include your own header file(s) in a model use <code>$INCLUDE</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>$INCLUDE</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>mystuff<span class="op">.</span>h</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>otherstuff<span class="op">.</span>h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>$INCLUDE</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>mystuff<span class="op">.</span>h<span class="op">,</span>  otherstuff<span class="op">.</span>h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>mrgsolve will insert proper <code>#include</code> preprocessor directives into the <code>C++</code> code that gets compiled.</p>
<p><strong>Requirements</strong></p>
<ul>
<li>All header files listed in <code>$INCLUDE</code> are assumed (expected) to be under the <code>project</code> directory; don’t use <code>$INCLUDE</code> for header files that are in any other location</li>
<li>An error is generated if the header file does not exist</li>
<li>An error is generated if any quotation marks are found in the file name (don’t use quotes around the file name; mrgsolve will take care of that)</li>
<li>A warning is issued if the header file does not end in <code>.h</code></li>
<li>When the header file is changed (MD5 checksum changes), the model will be forced to be rebuilt (recompiled) when <code>mread()</code> or <code>mcode()</code> (but not <code>mread_cache()</code> or <code>mcode_cache()</code>) is called; this feature is only available for header files listed in <code>$INCLUDE</code> (see below)</li>
<li>Do not use <code>$INCLUDE</code> to include <code>Rcpp</code>, <code>boost</code>, <code>RcppArmadillo</code> or <code>RcppEigen</code> headers; use the appropriate <code>$PLUGIN</code> instead</li>
</ul>
<p>For applications that don’t fit into the requirements listed above, users can always include header files in the model in <code>$GLOBAL</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>$GLOBAL</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"/Users/me/libs/mystuff.h"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But be careful when doing this: if there are changes to <code>mystuff.h</code> but not to any other part of the model specification, the model may not be fully compiled when calling <code>mread</code>. In this case, always use <code>preclean=TRUE</code> argument to <code>mread</code> to force the model to be built when calling <code>mread</code>.</p>
</section>
<section id="sec-block-env" class="level3" data-number="2.2.27">
<h3 data-number="2.2.27" class="anchored" data-anchor-id="sec-block-env"><span class="header-section-number">2.2.27</span> <code>$ENV</code> &nbsp;</h3>
<p><strong>Syntax</strong>: R<br>
<strong>Multiple allowed</strong>: no</p>
<p>This block is all <code>R</code> code (just as you would code in a stand-alone <code>R</code> script. The code is parsed and evaluated into a new environment when the model is compiled.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>$ENV</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>Sigma <span class="op">&lt;-</span> cmat<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="fl">0.6</span><span class="op">,</span><span class="dv">2</span><span class="op">)</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>mu <span class="op">&lt;-</span> c<span class="op">(</span><span class="dv">2</span><span class="op">,</span><span class="dv">4</span><span class="op">)</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>cama <span class="op">&lt;-</span> function<span class="op">(</span>mod<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  mod <span class="op">%&gt;%</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    ev<span class="op">(</span>amt<span class="op">=</span><span class="dv">100</span><span class="op">,</span> ii<span class="op">=</span><span class="dv">12</span><span class="op">,</span> addl<span class="op">=</span><span class="dv">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    mrgsim<span class="op">(</span>obsonly<span class="op">=</span>TRUE<span class="op">,</span>end<span class="op">=</span><span class="dv">120</span><span class="op">)</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Objects inside <code>$ENV</code> can be utilized in different C++ functions (see <a href="#sec-block-plugin" class="quarto-xref"><span>Section 2.2.22</span></a>) or other parts of the simulation process.</p>
<p>Objects inside <code>$ENV</code> will also be made available when parsing different parts of the model specification file. For example, we can initialize an <code>$OMEGA</code> block with the <code>Sigma</code> object in the <code>$ENV</code> block example above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>$OMEGA @object Sigma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another example is providing constants or functions to simplify code in the <code>$PARAM</code> block</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>$ENV</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>rescale <span class="op">&lt;-</span> <span class="dv">1</span><span class="op">/</span><span class="dv">1000</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>convert <span class="op">&lt;-</span> function<span class="op">(</span>x<span class="op">)</span> x <span class="op">*</span> <span class="dv">5</span> <span class="op">/</span> <span class="fl">166.2</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>$PARAM</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">500</span> <span class="op">*</span> rescale</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>q  <span class="op">=</span> convert<span class="op">(</span><span class="fl">2.51</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also make your model specification file depend on an R package; for example, if you want to use the <code>here</code> package to render a path to your NONMEM model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>$ENV</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(!</span>requireNamespace<span class="op">(</span><span class="st">"here"</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  stop<span class="op">(</span><span class="st">"the `here` package is required to load this model."</span><span class="op">)</span>  </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>$NMXML</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>run <span class="op">=</span> <span class="dv">101</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>project <span class="op">=</span> here<span class="op">::</span>here<span class="op">(</span><span class="st">"model/nonmem"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can access the model environment using the <code>env_get()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>env_get<span class="op">(</span>mod<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or directly in the <code>envir</code> slot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>mod@envir</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See also <code>env_ls()</code> to list the names of variables in the model environment, <code>env_update()</code> to change the values of objects in the model environment, or <code>env_eval</code> to re-evaluate the model environment code.</p>
</section>
</section>
<section id="sec-variables-macros" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-variables-macros"><span class="header-section-number">2.3</span> Variables and Macros</h2>
<p>This section describes some macros and internal variables that can be used in model specification files. In the following section, we adopt the convention that <code>CMT</code> stands for a compartment in the model.</p>
<p><strong>IMPORTANT NOTE</strong>:</p>
<p>It should be clear from the usage examples which variables can be set by the user and which are to be read or checked. <strong>All internal variables are pre-defined and pre-initialized by mrgsolve. <em>The user should never try to declare an internal variable; this will always result in an compile-time error</em></strong>.</p>
<section id="id" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="id"><span class="header-section-number">2.3.1</span> <code>ID</code></h3>
<p>The current subject identifier. <code>ID</code> is an alias for <code>self.id</code>.</p>
</section>
<section id="time" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="time"><span class="header-section-number">2.3.2</span> <code>TIME</code></h3>
<p>Gives the time in the current data set record. This is usually only used in <code>$MAIN</code> or <code>$TABLE</code>. <code>TIME</code> is an alias for <code>self.time</code>. Contrast with <code>SOLVERTIME</code>.</p>
</section>
<section id="solvertime" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="solvertime"><span class="header-section-number">2.3.3</span> <code>SOLVERTIME</code></h3>
<p>Gives the time of the current timestep taken by the solver. <em>This is can only be used in <code>$ODE</code></em>. Contrast with <code>TIME</code>.</p>
<p>Starting with mrgsolve version 1.0.0, the variable <code>T</code> is provided as a synonym to <code>SOLVERTIME</code> inside <code>$ODE</code> when you invoke the <code>nm-vars</code> plugin (<a href="plugins.html#sec-plugin-nm-vars" class="quarto-xref"><span>Section 9.2</span></a>).</p>
</section>
<section id="t" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="t"><span class="header-section-number">2.3.4</span> <code>T</code></h3>
<p>Only provided when the <code>nm-vars</code> plugin is invoked; see <code>SOLVERTIME</code>.</p>
</section>
<section id="evid" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5" class="anchored" data-anchor-id="evid"><span class="header-section-number">2.3.5</span> <code>EVID</code></h3>
<p><code>EVID</code> is an event id indicator. mrgsolve recognized the following event IDs:</p>
<ul>
<li>0 = an observation record</li>
<li>1 = a bolus or infusion dose</li>
<li>2 = other type event, with solver reset</li>
<li>3 = system reset</li>
<li>4 = system reset and dose</li>
<li>8 = replace</li>
</ul>
<p><code>EVID</code> is an alias for <code>self.evid</code>.</p>
</section>
<section id="cmt" class="level3" data-number="2.3.6">
<h3 data-number="2.3.6" class="anchored" data-anchor-id="cmt"><span class="header-section-number">2.3.6</span> <code>CMT</code></h3>
<p><code>CMT</code> is the current compartment number. In this case, <code>CMT</code> is used literally (not a stand-in for the name of a compartment). For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>$CMT GUT CENT PERIPH</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>CMT<span class="op">==</span><span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ....</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the example, <code>GUT</code>, <code>CENT</code> and <code>PERIPH</code> are the amounts in the respective compartments and <code>CMT</code> refers to the value of <code>CMT</code> in the data record / data set.</p>
<p><code>CMT</code> is an alias for <code>self.cmt</code>.</p>
</section>
<section id="amt" class="level3" data-number="2.3.7">
<h3 data-number="2.3.7" class="anchored" data-anchor-id="amt"><span class="header-section-number">2.3.7</span> <code>AMT</code></h3>
<p><code>AMT</code> is the current value of dose amount.</p>
<p><code>AMT</code> is an alias for <code>self.amt</code>.</p>
</section>
<section id="newind" class="level3" data-number="2.3.8">
<h3 data-number="2.3.8" class="anchored" data-anchor-id="newind"><span class="header-section-number">2.3.8</span> <code>NEWIND</code></h3>
<p><code>NEWIND</code> is a new individual indicator, taking the following values:</p>
<ul>
<li>0 for the first event record of the data set</li>
<li>1 for the first event record of a subsequent individual</li>
<li>2 for subsequent event record for an individual</li>
</ul>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> GLOBAL <span class="op">]</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> MAIN <span class="op">]</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>NEWIND <span class="op">&lt;=</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  counter  <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>NEWIND</code> is an alias for <code>self.newind</code>.</p>
</section>
<section id="ss_advance" class="level3" data-number="2.3.9">
<h3 data-number="2.3.9" class="anchored" data-anchor-id="ss_advance"><span class="header-section-number">2.3.9</span> <code>SS_ADVANCE</code></h3>
<p>This is a <code>bool</code> data item (either <code>true</code> or <code>false</code>) which is always <code>false</code> unless mrgsolve is currently advancing the system to steady state (<a href="steady-state.html" class="quarto-xref"><span>Chapter 8</span></a>); then it will be <code>true</code>. This variable is only available in the <code>$ODE</code> (or <code>$DES</code>) block.</p>
<p>Use this variable to modify the calculation of your model differential equations while the system is advancing to steady state. One use case is when you have an accumulation compartment to calculate <code>AUC</code> but you want to halt accumulation while the system is working toward steady state</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>$ODE</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>dxdt_CENT <span class="op">=</span> <span class="op">-(</span>CL<span class="op">/</span>V<span class="op">)</span> <span class="op">*</span> CENT<span class="op">;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>dxdt_AUC <span class="op">=</span> CENT<span class="op">/</span>V<span class="op">;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>SS_ADVANCE<span class="op">)</span> dxdt_AUC <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simeta" class="level3" data-number="2.3.10">
<h3 data-number="2.3.10" class="anchored" data-anchor-id="simeta"><span class="header-section-number">2.3.10</span> <code>simeta()</code></h3>
<p>The <code>simeta()</code> function can be used to re-simulate ETA values. For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>simeta<span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>will re-simulate all <code>ETA(n)</code>.</p>
</section>
<section id="simeps" class="level3" data-number="2.3.11">
<h3 data-number="2.3.11" class="anchored" data-anchor-id="simeps"><span class="header-section-number">2.3.11</span> <code>simeps()</code></h3>
<p><code>simeps()</code> works like <code>simeta()</code>, but all <code>EPS(n)</code> values are re-simulated rather than the ETA values.</p>
</section>
<section id="sec-self-object" class="level3" data-number="2.3.12">
<h3 data-number="2.3.12" class="anchored" data-anchor-id="sec-self-object"><span class="header-section-number">2.3.12</span> <code>self</code> &nbsp;</h3>
<p><code>self</code> is an object that gets passed to your model function that contains data items and functions that can be called. It is a <code>struct</code> (see the source code <a href="https://github.com/metrumresearchgroup/mrgsolve/blob/master/inst/base/mrgsolv.h">here</a>). A partial list of members are documented in the following sections.</p>
<p><code>self</code> functions include</p>
<ul>
<li><code>self.tad()</code></li>
<li><code>self.mtime()</code></li>
<li><code>self.mevent()</code></li>
<li><code>self.stop()</code></li>
<li><code>self.stop_id()</code></li>
<li><code>self.stop_id_cf()</code></li>
</ul>
<p><code>self</code> data members include</p>
<ul>
<li><code>self.id</code> (<code>ID</code>)</li>
<li><code>self.amt</code> (<code>AMT</code>)</li>
<li><code>self.cmt</code> (<code>CMT</code>)</li>
<li><code>self.evid</code> (<code>EVID</code>)</li>
<li><code>self.time</code> (<code>TIME</code>)</li>
<li><code>self.newind</code> (<code>NEWIND</code>)</li>
<li><code>self.nid</code></li>
<li><code>self.idn</code></li>
<li><code>self.rown</code></li>
<li><code>self.nrow</code></li>
<li><code>self.envir</code> (see note below)</li>
</ul>
<p>This information is provided for transparency and is not exhaustive. We provide an interface to these data items through pre-processor directives with simpler names (e.g.&nbsp;<code>EVID</code> will translate to <code>self.evid</code>) and users are encouraged to use the simpler, API name.</p>
</section>
<section id="sec-self.time" class="level3" data-number="2.3.13">
<h3 data-number="2.3.13" class="anchored" data-anchor-id="sec-self.time"><span class="header-section-number">2.3.13</span> <code>self.time</code></h3>
<p>The current data set <code>TIME</code>.</p>
</section>
<section id="self.cmt" class="level3" data-number="2.3.14">
<h3 data-number="2.3.14" class="anchored" data-anchor-id="self.cmt"><span class="header-section-number">2.3.14</span> <code>self.cmt</code></h3>
<p>The current compartment number regardless of whether it was given as <code>cmt</code> or <code>CMT</code> in the data set. There is no alias for <code>self.cmt</code>.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> DV <span class="op">=</span> CENT<span class="op">/</span>VC <span class="op">+</span> EPS<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>self<span class="op">.</span>cmt<span class="op">==</span><span class="dv">3</span><span class="op">)</span> DV <span class="op">=</span> RESPOSE <span class="op">+</span> EPS<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="self.amt" class="level3" data-number="2.3.15">
<h3 data-number="2.3.15" class="anchored" data-anchor-id="self.amt"><span class="header-section-number">2.3.15</span> <code>self.amt</code></h3>
<p>The current <code>amt</code> value regardless of whether it was given as <code>amt</code> or <code>AMT</code> in the data set. There is no alias for <code>self.amt</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PREAMBLE <span class="op">]</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> last_dose <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> MAIN <span class="op">]</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>EVID<span class="op">==</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  last_dose <span class="op">=</span> self<span class="op">.</span>amt<span class="op">;</span>  </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="self.nid" class="level3" data-number="2.3.16">
<h3 data-number="2.3.16" class="anchored" data-anchor-id="self.nid"><span class="header-section-number">2.3.16</span> <code>self.nid</code></h3>
<p>The number of IDs in the data set.</p>
</section>
<section id="self.idn" class="level3" data-number="2.3.17">
<h3 data-number="2.3.17" class="anchored" data-anchor-id="self.idn"><span class="header-section-number">2.3.17</span> <code>self.idn</code></h3>
<p>The current ID number. Numbers start at 0 and increase by one to <code>self.nid-1</code>. So if you want to test for the last ID in the output data set, you would write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> table <span class="op">]</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>self<span class="op">.</span>idn <span class="op">==</span> <span class="op">(</span>self<span class="op">.</span>nid<span class="op">-</span><span class="dv">1</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// do something ....</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="self.nrow" class="level3" data-number="2.3.18">
<h3 data-number="2.3.18" class="anchored" data-anchor-id="self.nrow"><span class="header-section-number">2.3.18</span> <code>self.nrow</code></h3>
<p>The total number of rows in the output data set.</p>
</section>
<section id="self.rown" class="level3" data-number="2.3.19">
<h3 data-number="2.3.19" class="anchored" data-anchor-id="self.rown"><span class="header-section-number">2.3.19</span> <code>self.rown</code></h3>
<p>The current row number. Numbers start at 0 and increase by one to <code>self.rown-1</code>. So if you want to test for the last row in the output data set, you would write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> table <span class="op">]</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>self<span class="op">.</span>rown <span class="op">==</span> <span class="op">(</span>self<span class="op">.</span>nrow<span class="op">-</span><span class="dv">1</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// do something ....</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="self.envir" class="level3" data-number="2.3.20">
<h3 data-number="2.3.20" class="anchored" data-anchor-id="self.envir"><span class="header-section-number">2.3.20</span> <code>self.envir</code></h3>
<p>This item is a null pointer that can be cast to an <code>Rcpp::Environment</code> only when the <code>Rcpp</code> plugin is invoked (see <a href="plugins.html#sec-plugin-rcpp" class="quarto-xref"><span>Section 9.6</span></a>).</p>
<p>For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> plugin <span class="op">]</span> Rcpp mrgx</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> preamble <span class="op">]</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>Rcpp<span class="op">::</span>Environment env <span class="op">=</span> mrgx<span class="op">::</span>get_envir<span class="op">(</span>self<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-self.tad" class="level3" data-number="2.3.21">
<h3 data-number="2.3.21" class="anchored" data-anchor-id="sec-self.tad"><span class="header-section-number">2.3.21</span> <code>self.tad()</code> &nbsp;</h3>
<p>This is a function that calculates and returns the time after the most recent dose event record (any record with EVID equal to 1 or 4). <code>self.tad()</code> will return <code>-1</code> when it is called before the first dose record within an individual (<code>NEWIND &lt;= 1</code>).</p>
<p>This function should be called in <code>$MAIN</code> every time <code>$MAIN</code> is called.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> TAD <span class="op">=</span> self<span class="op">.</span>tad<span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Do not make this calculation depend on any test or condition; it must be called every time <code>$MAIN</code> is called in order to see every dose.</p>
</section>
<section id="sec-self.mtime" class="level3" data-number="2.3.22">
<h3 data-number="2.3.22" class="anchored" data-anchor-id="sec-self.mtime"><span class="header-section-number">2.3.22</span> <code>self.mtime(&lt;time&gt;)</code> &nbsp;</h3>
<p>This is a function that creates a modeled even time. The only argument is a numeric time in the future for the current individual that indicates when a discontinuity should be included in the simulation.</p>
<p>When when <code>self.mtime()</code> is called, a new record is added to the current individual’s record set with <code>EVID</code> set to 2. This means that when the system advances to this record (this time), the differential equation solver will reset and restart, creating the discontinuity. The function returns the time of this event so the user can work with it in subsequent code.</p>
<p>For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>$PARAM change_point <span class="op">=</span> <span class="fl">5.13</span><span class="op">;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> KA <span class="op">=</span> <span class="fl">1.1</span><span class="op">;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> mt1 <span class="op">=</span> self<span class="op">.</span>mtime<span class="op">(</span>change_point<span class="op">);</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>TIME <span class="op">&gt;=</span> mt1<span class="op">)</span> KA <span class="op">=</span> <span class="fl">2.1</span><span class="op">;</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="self.meventtime-evid" class="level3" data-number="2.3.23">
<h3 data-number="2.3.23" class="anchored" data-anchor-id="self.meventtime-evid"><span class="header-section-number">2.3.23</span> <code>self.mevent(&lt;time&gt;, &lt;evid&gt;)</code></h3>
<p>Related to <code>self.mtime()</code> (<a href="#sec-self.mtime" class="quarto-xref"><span>Section 2.3.22</span></a>), except you can set a specific <code>EVID</code> for this intervention and you track the change time via <code>EVID</code> rather than the time. You’d use this if you want to anchor several events in the future and be sure you can distinguish between them. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> main <span class="op">]</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span>mevent<span class="op">(</span>change_point1<span class="op">,</span> <span class="dv">33</span><span class="op">);</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span>mevent<span class="op">(</span>change_point2<span class="op">,</span> <span class="dv">34</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, you can look for <code>EVID==33</code> to know you have hit <code>change_point1</code> or <code>EVID==34</code> to indicate that you have hit <code>change_point2</code>. Notice that <code>self.mevent()</code> doesn’t return any value. You will know that you’ve hit the change time by checking <code>EVID</code>.</p>
</section>
<section id="self.stop" class="level3" data-number="2.3.24">
<h3 data-number="2.3.24" class="anchored" data-anchor-id="self.stop"><span class="header-section-number">2.3.24</span> <code>self.stop()</code></h3>
<p>This <code>self</code> function is available to be called from <code>$PREAMBLE</code>, <code>$MAIN</code>, and <code>$TABLE</code>. When this function is called, the entire problem is stopped upon processing the next simulation record.</p>
<p>This might be called when something really bad happened and you just want to stop the simulation with an error.</p>
</section>
<section id="self.stop_id" class="level3" data-number="2.3.25">
<h3 data-number="2.3.25" class="anchored" data-anchor-id="self.stop_id"><span class="header-section-number">2.3.25</span> <code>self.stop_id()</code></h3>
<p>This <code>self</code> function is available to be called from <code>$PREAMBLE</code>, <code>$MAIN</code>, and <code>$TABLE</code>. When this function is called, processing of the current individual is stopped and missing values (<code>NA_real</code>) are filled in for remaining compartment’ and capture outputs.</p>
<p>This might be called when some condition is reached in the current individual that indicates either that the rest of the outputs are inconsequential or there was a problem with this particular individual.</p>
<p>See also <code>self.stop_id()</code> and <code>self.stop()</code>.</p>
</section>
<section id="self.stop_id_cf" class="level3" data-number="2.3.26">
<h3 data-number="2.3.26" class="anchored" data-anchor-id="self.stop_id_cf"><span class="header-section-number">2.3.26</span> <code>self.stop_id_cf()</code></h3>
<p>This <code>self</code> function is available to be called from <code>$PREAMBLE</code>, <code>$MAIN</code>, and <code>$TABLE</code>. When this function is called, processing of the current individual is stopped and current values are carried forward (<code>cf</code>) for the remaining output records for that individual.</p>
<p>This might be called when some condition is reached in the current individual that indicates either that the rest of the outputs are inconsequential or there was a problem with this particular individual.</p>
<p>See also <code>self.stop_id_cf()</code> and <code>self.stop()</code>.</p>
</section>
<section id="thetan" class="level3" data-number="2.3.27">
<h3 data-number="2.3.27" class="anchored" data-anchor-id="thetan"><span class="header-section-number">2.3.27</span> <code>THETA(n)</code></h3>
<p><code>THETA(n)</code> is ubiquitous in NONMEM control streams, representing estimated fixed effect parameters. mrgsolve does not attach any special meaning to <code>THETA(n)</code> but starting with version 1.0.0 it will translate <code>THETA(n)</code> to <code>THETAn</code>. This is useful when importing NONMEM estimates using <code>$NMXML</code> or <code>$NMEXT</code>, where <code>THETA</code>s are imported as parameters with names <code>THETA1</code>, <code>THETA2</code>, <code>THETA3</code> and so on (see <a href="#sec-block-nmxml" class="quarto-xref"><span>Section 2.2.24</span></a> and <a href="#sec-block-nmext" class="quarto-xref"><span>Section 2.2.25</span></a>). <code>THETA(n)</code> is simply a NONMEM-oriented style for referring to <code>THETAn</code>.</p>
</section>
<section id="etan" class="level3" data-number="2.3.28">
<h3 data-number="2.3.28" class="anchored" data-anchor-id="etan"><span class="header-section-number">2.3.28</span> <code>ETA(n)</code></h3>
<p><code>ETA(n)</code> is the value of the subject-level variate drawn from the model <code>OMEGA</code> matrix. <code>ETA(1)</code> through <code>ETA(25)</code> have default values of zero so they may be used in a model even if appropriate <code>OMEGA</code> matrices have not been provided.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>$OMEGA</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CL <span class="op">=</span> TVCL<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> VC <span class="op">=</span> TVVC<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> KA <span class="op">=</span> TVKA<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">3</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we have a 3x3 <code>OMEGA</code> matrix. <code>ETA(1)</code>, <code>ETA(2)</code>, and <code>ETA(3)</code> will be populated with variates drawn from this matrix. <code>ETA(4)</code> through <code>ETA(25)</code> will be populated with zero.</p>
</section>
<section id="epsn" class="level3" data-number="2.3.29">
<h3 data-number="2.3.29" class="anchored" data-anchor-id="epsn"><span class="header-section-number">2.3.29</span> <code>EPS(n)</code></h3>
<p><code>EPS(n)</code> holds the current value of the observation-level random variates drawn from <code>SIGMA</code>. The basic setup is the same as detailed in <code>ETA(n)</code>.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> CMT <span class="op">]</span> CENT</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> CL<span class="op">=</span><span class="dv">1</span><span class="op">,</span> VC<span class="op">=</span><span class="dv">20</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> SIGMA <span class="op">]</span> </span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span> <span class="fl">0.0025</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> TABLE <span class="op">]</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> DV <span class="op">=</span> <span class="op">(</span>CENT<span class="op">/</span>VC<span class="op">)*(</span><span class="dv">1</span><span class="op">+</span>EPS<span class="op">(</span><span class="dv">2</span><span class="op">))</span> <span class="op">+</span> EPS<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sigman" class="level3" data-number="2.3.30">
<h3 data-number="2.3.30" class="anchored" data-anchor-id="sigman"><span class="header-section-number">2.3.30</span> <code>SIGMA(n)</code></h3>
<p>Starting with version 1.0.8, users have read-only access to on-diagonal elements of <span class="math inline">\(\Sigma\)</span> through the <code>SIGMA()</code> macro. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>$SIGMA <span class="fl">0.1</span> <span class="dv">12</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> STD <span class="op">=</span> sqrt<span class="op">(</span>SIGMA<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">+</span> pow<span class="op">(</span>F<span class="op">,</span><span class="dv">2</span><span class="op">)*</span>SIGMA<span class="op">(</span><span class="dv">2</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tablename" class="level3" data-number="2.3.31">
<h3 data-number="2.3.31" class="anchored" data-anchor-id="tablename"><span class="header-section-number">2.3.31</span> <code>table(&lt;name&gt;)</code></h3>
<p>This macro has been deprecated. Users should <strong>not</strong> use code like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> TABLE <span class="op">]</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>table<span class="op">(</span>CP<span class="op">)</span> <span class="op">=</span> CENT<span class="op">/</span>VC<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But rather this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>$TABLE </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CP <span class="op">=</span> CENT<span class="op">/</span>VC<span class="op">;</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>$CAPTURE CP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See: <a href="#sec-block-table" class="quarto-xref"><span>Section 2.2.12</span></a> and also <a href="#sec-block-capture" class="quarto-xref"><span>Section 2.2.16</span></a>.</p>
</section>
<section id="sec-spec-f" class="level3" data-number="2.3.32">
<h3 data-number="2.3.32" class="anchored" data-anchor-id="sec-spec-f"><span class="header-section-number">2.3.32</span> <code>F_CMT</code> &nbsp;</h3>
<p>For the <code>CMT</code> compartment, sets the bioavailability fraction for that compartment.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>F_CENT <span class="op">=</span> <span class="fl">0.7</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-spec-alag" class="level3" data-number="2.3.33">
<h3 data-number="2.3.33" class="anchored" data-anchor-id="sec-spec-alag"><span class="header-section-number">2.3.33</span> <code>ALAG_CMT</code> &nbsp;</h3>
<p>For the <code>CMT</code> compartment, sets the lag time for doses into that compartment.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>ALAG_GUT <span class="op">=</span> <span class="fl">0.25</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-spec-r" class="level3" data-number="2.3.34">
<h3 data-number="2.3.34" class="anchored" data-anchor-id="sec-spec-r"><span class="header-section-number">2.3.34</span> <code>R_CMT</code> &nbsp;</h3>
<p>For the <code>CMT</code> compartment, sets the infusion rate for that compartment. The infusion rate is only set via <code>R_CMT</code> when <code>rate</code> in the data set or event object is set to <code>-1</code>.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>R_CENT <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rn" class="level3" data-number="2.3.35">
<h3 data-number="2.3.35" class="anchored" data-anchor-id="rn"><span class="header-section-number">2.3.35</span> <code>Rn</code></h3>
<p>Only available when the <code>nm-vars</code> plugin is invoked; see <code>R_CMT</code>.</p>
</section>
<section id="sec-spec-d" class="level3" data-number="2.3.36">
<h3 data-number="2.3.36" class="anchored" data-anchor-id="sec-spec-d"><span class="header-section-number">2.3.36</span> <code>D_CMT</code> &nbsp;</h3>
<p>For the <code>CMT</code> compartment, sets the infusion duration for that compartment.<br>
The infusion duration is only set via <code>D_CMT</code> when <code>rate</code> in the data set or event object is set to <code>-2</code>.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>D_CENT <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="nonmem-like-syntax" class="level3" data-number="2.3.37">
<h3 data-number="2.3.37" class="anchored" data-anchor-id="nonmem-like-syntax"><span class="header-section-number">2.3.37</span> NONMEM-like syntax</h3>
<p>There is a NONMEM-like syntax that lets you write <code>F1</code> rather than <code>F_GUT</code>, <code>D2</code> rather than <code>D_CENT</code> as well as other variables that are commonly used in a NONMEM control stream. To make this syntax available, the <code>nm-vars</code> plugin must be invoked.</p>
<p>See <a href="plugins.html#sec-plugin-nm-vars" class="quarto-xref"><span>Section 9.2</span></a> on the <code>nm-vars</code> plugin for details.</p>
</section>
</section>
<section id="reserved-words" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="reserved-words"><span class="header-section-number">2.4</span> Reserved words</h2>
<p>Reserved words cannot be used as names for parameters, compartments or other derived variables in the model. <strong>Note</strong> that some of these words are “reserved” for you to use in your data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>ID</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>amt</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>cmt</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>ii</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>ss</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>evid</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>addl</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>rate</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>time</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>SOLVERTIME</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>table</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>ETA</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>EPS</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>AMT</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>CMT</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>ID</span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>TIME</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>EVID</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>simeps</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>self</span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>simeta</span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>NEWIND</span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>DONE</span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>CFONSTOP</span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>DXDTZERO</span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>CFONSTOP</span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>INITSOLV</span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>_F</span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>_R</span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>_ALAG</span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a>SETINIT</span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>report</span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>_VARS_</span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a>VARS</span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a>SS_ADVANCE</span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>AMT</span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>CMT</span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>II</span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>SS</span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a>ADDL</span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a>RATE</span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a>THETA</span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a>pred_CL</span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a>pred_VC</span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a>pred_V</span>
<span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a>pred_V2</span>
<span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a>pred_KA</span>
<span id="cb116-48"><a href="#cb116-48" aria-hidden="true" tabindex="-1"></a>pred_Q</span>
<span id="cb116-49"><a href="#cb116-49" aria-hidden="true" tabindex="-1"></a>pred_VP</span>
<span id="cb116-50"><a href="#cb116-50" aria-hidden="true" tabindex="-1"></a>pred_V3</span>
<span id="cb116-51"><a href="#cb116-51" aria-hidden="true" tabindex="-1"></a>double</span>
<span id="cb116-52"><a href="#cb116-52" aria-hidden="true" tabindex="-1"></a>int</span>
<span id="cb116-53"><a href="#cb116-53" aria-hidden="true" tabindex="-1"></a>bool</span>
<span id="cb116-54"><a href="#cb116-54" aria-hidden="true" tabindex="-1"></a>capture</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Other reserved words depend on the compartment names in your model. For example, if you have a compartment called <code>CENT</code> in the model, then the the following will be reserved</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>F_CENT</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>R_CENT</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>D_CENT </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>ALAG_CENT</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>N_CENT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-new-variables" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="sec-new-variables"><span class="header-section-number">2.5</span> Derive new variables</h2>
<p>New <code>C++</code> variables may be derived in <code>$GLOBAL</code>, <code>$PREAMBLE</code> <code>$MAIN</code>, <code>$ODE</code> and <code>$TABLE</code>. Because these are <code>C++</code> variables, the type of variable being used must be declared. For the vast majority of applications, the <code>double</code> type is used (double-precision numeric value).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CLi <span class="op">=</span> TVCL<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want <code>CLi</code> to be a numeric value, so we use <code>double</code>. To initialize a <code>boolean</code> variable (true / false), write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> cure <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="special-handling-for-double-int-bool" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="special-handling-for-double-int-bool"><span class="header-section-number">2.5.1</span> Special handling for <code>double</code>, <code>int</code>, <code>bool</code></h3>
<p>When variables of the type <code>double</code>, <code>int</code>, and <code>bool</code> are declared and initialized in <code>$PREAMBLE</code>, <code>$MAIN</code>, <code>$ODE</code>, <code>$TABLE</code>, mrgsolve will detect those declarations, and modify the code so that the variables are actually declared once in <code>$GLOBAL</code> not in <code>$MAIN</code>, <code>$ODE</code>, or <code>$TABLE</code>. This is done so that variables declared in one code block (e.g.&nbsp;<code>$MAIN</code>) can be read and modified in another code block (e.g.&nbsp;<code>$TABLE</code>).</p>
<p>For example, in the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CLi <span class="op">=</span> TVCL<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>a double-precision numeric variable is created (<code>CLi</code>) in the <code>$MAIN</code> block. When mrgsolve parses the model file, this code gets translated to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>$GLOBAL</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>namespace <span class="op">{</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> CLi<span class="op">;</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>CLi <span class="op">=</span> TVCL<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That is, <code>CLi</code> is declared in <code>$GLOBAL</code> in an unnamed namespace so that variables like this are global variables within the model file only.</p>
<p>This way, we can still read the <code>CLi</code> variable in <code>$TABLE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CLi <span class="op">=</span> TVCL<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> VCi <span class="op">=</span> TVVC<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> KEi <span class="op">=</span> CLi<span class="op">/</span>VCi<span class="op">;</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>$CAPTURE KEi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To declare a variable that is local to a particular code block:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>localdouble CLi <span class="op">=</span> TVCL<span class="op">*</span>exp<span class="op">(</span>ETA<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>localdouble</code> type is still just a double-precision variable. The difference is that it is protected from this re-declaration process and the variable will be local to (in this case) the <code>$MAIN</code> block.</p>
</section>
<section id="initializing-and-resetting" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="initializing-and-resetting"><span class="header-section-number">2.5.2</span> Initializing and resetting</h3>
<p>mrgsolve takes a hands-off approach to variables created by the user; it will not initialize or reset variables from record to record or from individual to individual. Failing to properly initialize or reset user variables can have unintended consequences, especially when conditional logic is used.</p>
<p>Generally, a default value for all variables should be set prior to conditional assignment based on some test condition.</p>
</section>
<section id="using-other-types-globally" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="using-other-types-globally"><span class="header-section-number">2.5.3</span> Using other types globally</h3>
<p>As we noted in the previous section, <code>double</code>, <code>int</code>, and <code>bool</code> are processed in a special way so that they are by default global to the file. Many times we want to work with other variable types in a global manner. Whenever you want a data structure to be accessible across functions (e.g.&nbsp;<code>$MAIN</code>, <code>$TABLE</code>, etc.) they should be declared in <code>$GLOBAL</code>, optionally in an unnamed namespace.</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> GLOBAL <span class="op">]</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>std<span class="op">::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> myvec<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> GLOBAL <span class="op">]</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>namespace <span class="op">{</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  std<span class="op">::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> myvec<span class="op">;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In case that object needs some configuration prior to starting the problem, use <code>$PREAMBLE</code> to do that work</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> GLOBAL <span class="op">]</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>std<span class="op">::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> myvec<span class="op">;</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PREAMBLE <span class="op">]</span> </span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>myvec<span class="op">.</span>assign<span class="op">(</span><span class="dv">3</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="random-number-generation" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="random-number-generation"><span class="header-section-number">2.6</span> Random number generation</h2>
<p>Users can simulate random numbers inside a model file using functions that are similar to the functions you’d normally use in R (e.g.&nbsp;<code>rnorm()</code> and <code>runif()</code>). This functionality is provided by <code>Rcpp</code> and therefore requires using the <code>Rcpp</code> plugin (see <a href="plugins.html" class="quarto-xref"><span>Chapter 9</span></a> and <a href="plugins.html#sec-plugin-rcpp" class="quarto-xref"><span>Section 9.6</span></a>).</p>
<p><code>Rcpp</code> provides these functions inside the <code>R</code> namespace so you will have to prefix the function call with <code>R::</code>.</p>
<p>As an example, to make a draw from Uniform (0,1)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> plugin <span class="op">]</span> Rcpp</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> error <span class="op">]</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> draw <span class="op">=</span> R<span class="op">::</span>runif<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the <code>0</code> gets used as <code>min</code> and the <code>1</code> gets used as <code>max</code>;<br>
we didn’t pass <code>n</code> here and <code>draw</code> is a single number (not a vector like you’d get from (<code>runif(100, 0, 1)</code> on your R console). So in general, these functions work like their <code>R</code> counterparts, but without the <code>n</code> argument.</p>
<p>Another example showing how to draw from binomial distribution with probability 0.5</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> plugin <span class="op">]</span> Rcpp</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> error <span class="op">]</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> draw <span class="op">=</span> R<span class="op">::</span>rbinom<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the <code>1</code> is used as <code>size</code> (not <code>n</code>) and <code>0.5</code> is used as <code>prob</code>.</p>
<p>Other helpful functions could be <code>R::rnorm()</code> or <code>R::rlnorm()</code> but you can call any of the <code>r</code> functions as well as the corresponding <code>dpq</code> functions through this <code>R</code> namespace.</p>
<p>Documentation, including functions to call and arguments can be found in the Rcpp API docs</p>
<p>http://dirk.eddelbuettel.com/code/rcpp/html/namespaceR.html</p>
</section>
<section id="examples" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="examples"><span class="header-section-number">2.7</span> Examples</h2>
<p>The following sections show example model specification. The intention is to show how the different blocks, macros and variables can work together to make a functional model. Some models are given purely for illustrative purpose and may not be particularly useful in application.</p>
<section id="simple-pk-model" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="simple-pk-model"><span class="header-section-number">2.7.1</span> Simple PK model</h3>
<p>Notes:</p>
<ul>
<li>Basic PK parameters are declared in <code>$PARAM</code>; every parameter needs to be assigned a value</li>
<li>Two compartments <code>GUT</code> and <code>CENT</code> are declared in <code>$CMT</code>; using <code>$CMT</code> assumes that both compartments start with 0 mass</li>
<li>Because we declared <code>GUT</code> and <code>CENT</code> as compartments, we write <code>dxdt_</code> equations for both in <code>$ODE</code></li>
<li>In <code>$ODE</code>, we refer to parameters (<code>CL/VC/KA</code>) and the amounts in each compartment at any particular time (<code>GUT</code> and <code>CENT</code>)</li>
<li><code>$ODE</code> should be <code>C++</code> code; each line ends in <code>;</code></li>
<li>We derive a variable called <code>CP</code> in <code>$TABLE</code> that has type <code>capture</code>; mrgsolve will enter the <code>CP</code> name into the <code>$CAPTURE</code> block list</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>$PARAM CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> VC <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> KA <span class="op">=</span> <span class="fl">1.3</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>$CMT GUT CENT</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>$ODE</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>dxdt_GUT <span class="op">=</span> <span class="op">-</span>KA<span class="op">*</span>GUT<span class="op">;</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>dxdt_CENT <span class="op">=</span> KA<span class="op">*</span>GUT <span class="op">-</span> <span class="op">(</span>CL<span class="op">/</span>VC<span class="op">)*</span>CENT<span class="op">;</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>capture CP <span class="op">=</span> CENT<span class="op">/</span>VC<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This model can also be written without differential equations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PARAM <span class="op">]</span> CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> VC <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> KA <span class="op">=</span> <span class="fl">1.3</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> PKMODEL <span class="op">]</span> cmt <span class="op">=</span> <span class="st">"CMT GUT CENT"</span><span class="op">,</span> depot <span class="op">=</span> TRUE</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>capture CP <span class="op">=</span> CENT<span class="op">/</span>VC<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pkpd-model" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="pkpd-model"><span class="header-section-number">2.7.2</span> PK/PD model</h3>
<p>Notes:</p>
<ul>
<li>We use a preprocessor <code>#define</code> directive in <code>$GLOBAL</code>; everywhere in the model where a <code>CP</code> token is found, the expression <code>(CENT/VC)</code> … with parentheses … is inserted</li>
<li>We write the initial value for the <code>RESP</code> compartment in <code>$MAIN</code> as a function of two parameters <code>KIN/KOUT</code></li>
<li>A new variable - <code>INH</code>- is declared and used in <code>$ODE</code></li>
<li>Since <code>CP</code> is defined as <code>CENT/VC</code>, we can “capture” that name/value in <code>$CAPTURE</code></li>
<li>Both <code>$MAIN</code> and <code>$ODE</code> are <code>C++</code> code blocks; don’t forget to add the <code>;</code> at the end of each statement</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>$PARAM CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> VC <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> KA <span class="op">=</span> <span class="fl">1.3</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>KIN <span class="op">=</span> <span class="dv">100</span><span class="op">,</span> KOUT <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> IC50 <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>$GLOBAL</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CP </span><span class="op">(</span><span class="pp">CENT</span><span class="op">/</span><span class="pp">VC</span><span class="op">)</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>$CMT GUT CENT RESP</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>RESP_0 <span class="op">=</span> KIN<span class="op">/</span>KOUT<span class="op">;</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>$ODE</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> INH <span class="op">=</span> CP<span class="op">/(</span>IC50<span class="op">+</span>CP<span class="op">);</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>dxdt_GUT <span class="op">=</span> <span class="op">-</span>KA<span class="op">*</span>GUT<span class="op">;</span></span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>dxdt_CENT <span class="op">=</span> KA<span class="op">*</span>GUT <span class="op">-</span> <span class="op">(</span>CL<span class="op">/</span>VC<span class="op">)*</span>CENT<span class="op">;</span></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>dxdt_RESP <span class="op">=</span> KIN<span class="op">*(</span><span class="dv">1</span><span class="op">-</span>INH<span class="op">)</span> <span class="op">-</span> KOUT<span class="op">*</span>RESP<span class="op">;</span></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>$CAPTURE CP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="population-pk-model-with-covariates-and-iov" class="level3" data-number="2.7.3">
<h3 data-number="2.7.3" class="anchored" data-anchor-id="population-pk-model-with-covariates-and-iov"><span class="header-section-number">2.7.3</span> Population PK model with covariates and IOV</h3>
<p>Notes:</p>
<ul>
<li>Use <code>$SET</code> to set the simulation time grid from 0 to 240 by 0.1</li>
<li>There are two <code>$OMEGA</code> matrices; we name them <code>IIV</code> and <code>IOV</code></li>
<li>The IIV “etas” are labeled as <code>ECL/EVC/EKA</code>; these are aliases to <code>ETA(1)/ETA(2)/ETA(3)</code>. The <code>IOV</code> matrix is unlabeled; we must refer to <code>ETA(4)/ETA(5)</code> for this</li>
<li>Because <code>ETA(1)</code> and <code>ETA(2)</code> are labeled, we can “capture” them as <code>ECL</code> and <code>EVC</code></li>
<li>We added zeros for both <code>$OMEGA</code> matrices; all the etas will be zero until we populate those matrices (<a href="matrix.html#sec-matrix-update" class="quarto-xref"><span>Section 5.3</span></a>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>$PARAM TVCL <span class="op">=</span> <span class="fl">1.3</span><span class="op">,</span> TVVC<span class="op">=</span><span class="dv">28</span><span class="op">,</span> TVKA<span class="op">=</span><span class="fl">0.6</span><span class="op">,</span> WT<span class="op">=</span><span class="dv">70</span><span class="op">,</span> OCC<span class="op">=</span><span class="dv">1</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>$SET delta<span class="op">=</span><span class="fl">0.1</span><span class="op">,</span> end<span class="op">=</span><span class="dv">240</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>$CMT GUT CENT</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>$MAIN</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> IOV <span class="op">=</span> IOV1</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>OCC<span class="op">==</span><span class="dv">2</span><span class="op">)</span> IOV <span class="op">=</span> IOV2<span class="op">;</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CLi <span class="op">=</span> exp<span class="op">(</span>log<span class="op">(</span>TVCL<span class="op">)</span> <span class="op">+</span> <span class="fl">0.75</span><span class="op">*</span>log<span class="op">(</span>WT<span class="op">/</span><span class="dv">70</span><span class="op">)</span> <span class="op">+</span> ECL <span class="op">+</span> IOV<span class="op">);</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> VCi <span class="op">=</span> exp<span class="op">(</span>log<span class="op">(</span>TVVC<span class="op">)</span> <span class="op">+</span> EVC<span class="op">);</span></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> KAi <span class="op">=</span> exp<span class="op">(</span>log<span class="op">(</span>TVKA<span class="op">)</span> <span class="op">+</span> EKA<span class="op">);</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>$OMEGA @name IIV @labels ECL EVC EKA</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span></span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>$OMEGA @name IOV @labels IOV1 IOV2</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="dv">0</span></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>$SIGMA <span class="dv">0</span></span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>$ODE</span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>dxdt_GUT <span class="op">=</span> <span class="op">-</span>KAi<span class="op">*</span>GUT<span class="op">;</span></span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>dxdt_CENT <span class="op">=</span> KAi<span class="op">*</span>GUT <span class="op">-</span> <span class="op">(</span>CLi<span class="op">/</span>VCi<span class="op">)*</span>CENT<span class="op">;</span></span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>capture CP <span class="op">=</span> CENT<span class="op">/</span>VCi<span class="op">;</span></span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a>$CAPTURE IOV ECL EVC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./components.html" class="pagination-link  aria-label=" &lt;span="" components&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Model components</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./datasets.html" class="pagination-link" aria-label="<span class='chapter-number'>3</span>&nbsp; <span class='chapter-title'>Input data sets</span>">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Input data sets</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>